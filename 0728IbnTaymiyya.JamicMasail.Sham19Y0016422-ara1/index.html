<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta http-equiv="Content-Security-Policy" https:=""/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri&amp;display=swap" rel="stylesheet"/>
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="../css/stylev2.css" rel="stylesheet" type="text/css"/>
<script crossorigin="anonymous" src="../js/CollapsibleLists.js" type="application/javascript"></script>
<!-- <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/alpheios-components@latest/dist/style/style-components.min.css" /> -->
<script type="text/javascript">
</script>
</head>
<body>
<div id="loading">
<img alt="Loading..." id="loading-image" src="../img/spinner1.gif"/>
</div>
<div class="page-wrapper toggled" id="wrapper">
<div id="sidebar-wrapper">
<html><body><div class="card-header title-heading">فصول الكتاب</div><ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head0">AUTO فصول وقواعد</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head1">CHECK 1 - فصل في ذكر الله ودعائه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head2">CHECK 2 - فصل: قرن الله بين الكتاب والصلاة في مواضع</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head3">CHECK 3 - فصل: قال الله تعالى: {وكذلك جعلناكم أمة وسطا ...}</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head4">CHECK 4 - فصل: حديث حكيم بن حزام: ((إن هذا المال خضرة ...))</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head5">CHECK 5 - فصل: احتج بعض المبطلين في جواز السجود لغير الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head6">CHECK 6 - فصل: حركات العباد بقلوبهم وأبدانهم لا بد لها من غاية ووسيلة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head7">CHECK 7 - فصل: شبه الإباحية</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head8">CHECK 8 - فصل: تقول طائفة من أهل الكلام: إن الحركة وأنواعها لا تصح إلا على الأجسام دون الأعراض، فإن العرض لا يقوم بنفسه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head9">CHECK 9 - فصل: قال الله تعالى: {أفلم يدبروا القول أم جاءهم ما لم يأت آباءهم الأولين}</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head10">CHECK 10 - قاعدة: بعث الله محمدا بالهدى ودين الحق ليظهره على الدين كله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head11">CHECK 11 - فصل جامع: أن جماع الحسنات العدل، وجماع السيئات الظلم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head12">CHECK 12 - قاعدة في الإجبار على المعاوضات إذا لم يكن فيه ضرر، وعلى الغير بتركه ضرر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head13">CHECK 13 - فصل في ثواب الحسنات والسيئات</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head14">CHECK 14 - فصل: قال تعالى: {إن الله لا يحب كل مختال فخور}</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head15">CHECK 15 - فصل ثبت في الصحيح: ((ليس الكذاب الذي يصلح بين الناس ...))</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head16">CHECK 16 - فصل أثبت أئمة من أهل السنة ((الحد))</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head17">CHECK 17 - فصل الهجرة المشروعة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head18">CHECK 18 - قاعدة في جماع الدين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head19">CHECK 20 - فصل: قال الله تعالى فيما ذكره من موعظة لقمان لابنه: {واقصد في مشيك واغضض من صوتك}</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head20">CHECK 21 - قاعدة: أن النفس بل وكل حي له قوتان: قوة الحب وقوة البغض</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head21">CHECK 22 - فصل: باعتبار القوى الثلاث انقسمت الأمم (العرب والروم والفرس)</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head22">CHECK 23 - فصل: المشهور عند أهل السنة أنه لا يحبط العمل إلا الكفر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head23">CHECK 24 - فصل قوله: {ذلك أدنى أن يأتوا بالشهادة على وجهها أو يخافوا أن ترد أيمان بعد أيمانهم}</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head24">CHECK 25 - فصل: في حديث الكرب: ((... أن تجعل القرآن ربيع قلبي ...))</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head25">CHECK 26 - فصل: أن طريقة أتباع الأنبياء هي الموصلة إلى الحق دون طريقة من خالفهم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head26">CHECK 27 - فصل عظيم المنفعة في أمر المعاد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head27">CHECK 28 - فصل: قول من يقول: ((إن لله عبادا يرضى لرضاهم ويغضب لغضبهم)) حق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head28">CHECK 29 - فصل: الحروف والأصوات المكتوبة والمسموعة ثلاثة أقسام</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head29">CHECK 30 - فصل: في بعض الشرح والتقرير لقاعدة السنة والجماعة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head30">CHECK 31 - فصل: قال تعالى: {أولئك الذين أنعم الله عليهم من النبيين من ذرية آدم ...}</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head31">CHECK 32 - فصل: في المثل والكفو في الكتاب والسنة ولغة العرب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head32">CHECK 33 - أصل كلي جامع [في الشهادتين]</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head33">AUTO حكاية المناظرة في الواسطية PageV01P181 # [حكاية المناظرة في الواسطية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head34">CHECK فصل: أصل الإيمان والهدى ودين الحق هو الإيمان بالله ورسوله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head35">CHECK فصل: وصف الله أفضل أهل السعادة بالإيمان والهجرة والجهاد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head36">CHECK فصل: في الكلام على النعم، وهل هي للكفار أيضا؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head37">AUTO فصل في آية الربا PageV01P269 # فصل في آية الربا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head38">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head39">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head40">AUTO مسألة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head41">AUTO مسألة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head42">AUTO مسألة في الحضانة PageV01P413 # مسألة في الحضانة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head43">AUTO مسائل مختلفة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head44">CHECK 1 - سئل عمن تصيبة جنابة والماء يضره، أو يكون مجروحا، هل يجوز له أن يصلي بالتيمم أو يقرأ القرآن؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head45">CHECK 2 - مسألة في رجل دخل في الصلاة وقد أحرم الإمام، ثم ركع الإمام وقد قرأ الرجل بعض الفاتحة، ولم يتبع الإمام في الركوع حتى قرأ بقية الفاتحة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head46">CHECK 3 - مسألة في رجل أدرك الصلاة مع إمام، فلم يصل معه، وقال: أنا لا أصلي إلا خلف من يكون من أهل مذهبي. وفي رجل سئل عن مذهبه فقال: مذهبي اتباع الكتاب والسنة. وفي رجل عرض عليه حديث صحيح فأنكره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head47">CHECK 4 - مسألة في جماعة حنفية لهم إمام شافعي، فهل تصح صلاتهم خلفه أم لا؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head48">CHECK 5 - مسألة في إمام مدمن الخمر، هل تصح الصلاة خلفه أم لا؟ وما صفة مدمن الخمر؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head49">CHECK 6 - مسألة عن امرأة لم تكن تعرف تصلي، أين تكون من زوجها في الآخرة؟ وهل العذاب على النفس والبدن والروح أم على واحد دون الآخر؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head50">CHECK 7 - مسألة في عرب البادية الذين يكونون دائما في حل وترحال، هل يحل لهم القصر؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head51">CHECK 8 - مسائل متفرقة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head52">AUTO فيمن قتل النفس التي حرم الله بغير الحق، وتمكن أولياء المقتول من القود، ويعفو أولياء المقتول عنه، أو يصالحوه على شيء دون الدية الشرعية، هل يعود المقتول يطالب في الآخرة أم لا؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head53">AUTO ما تقول برجل كثير الحسنات كثير السيئات، فهل تكتب حسناته وسيئاته؟ أم يذهب بعضهن بعضا؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head54">AUTO ما يقول سيدنا في اليتيم والأرملة، هل هما من أهل الزكاة أم لا؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head55">AUTO ما يقول سيدنا بمن يستمني بيده، هل هو زنا أم لا؟ وماذا يجب عليه إذا فعل ذلك؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head56">AUTO وما يقول سيدنا في التين هل يجب عليه عشر أم لا؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head57">AUTO وما يقول سيدنا بمن يأكل الحرام ويترك الصلاة، هل يجوز أن يعطى الزكاة أم لا؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head58">CHECK فصل: إذا أقر الأب في ملك ms241 كان له بأنه ملك لأولاده بناء على أنه وهبه لهم، فله أن يرجع في هذه الهبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head59">AUTO وما يقول سيدنا في المسافر إذا نزل في موضع وهو يعلم أنه يقيم فيه عشر ليال وأكثر، فهل يجوز له أن يقصر ويجمع؟ أو يتم؟</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</body></html></div>
<div class="book body-inner" lang="ara">
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" style="direction: ltr;">
<div class="mr-auto d-flex justify-content-left">
<a class="navbar-brand ms-2" href="http://www.kitab-project.org" target="_blank">
<img class="d-inline-block align-top" src="https://cdn.jsdelivr.net/gh/sohailmerchant/kitab-cdn@main/img/kitab-logo.png" width="60px"/>
</a>
</div>
<div class="navbar-nav mx-auto btn-toolbar" style="direction: rtl;">
<div class="d-flex justify-content-center">
<form class="row" id="nav-form" style="margin-bottom: 0px;">
<span class="btn col justify-content-center">ج:</span>
<select class="col form-select pull-left" id="vol-select"></select>
<span class="btn col justify-content-center">ص:</span>
<select class="col form-select pull-left" id="page-select"></select>
<button class="btn col pull-right mx-3" id="nav-submdit-btn" style="width: 100px;" type="submit" value="Go">Go</button>
</form>
</div>
</div>
<div class="btn-toolbar navbar-nav ml-auto d-flex justify-content-right">
<div class="btn-group">
<a class="nav-link pull-right" title="Go to top">
<i class="btn bi bi-arrow-up-circle" id="back-to-top"></i>
</a>
<a class="nav-link pull-right" title="Increase fonts">
<i class="btn bi bi-fonts font-default pull-left"></i>
</a>
<a class="nav-link pull-right" title="Turn light off">
<i class="btn bi bi-lightbulb-off"></i>
</a>
<div class="nav-link pull-right dropdown">
<a aria-expanded="false" aria-haspopup="true" class="" data-bs-toggle="dropdown" id="dropdownMenuButton" role="button" title="Book Metadata">
<i class="btn bi bi-info"></i>
</a>
<div aria-labelledby="dropdownMenuButton" class="dropdown-menu">
<div class="col-12" id="metadata-content"><label>char_length: 306941</label><label>author_lat_full_name: </label><label>author_lat_shuhra: </label><label>author_from_uri: Ibn Taymiyya</label><label>tags:  :: Sham@الجوامع والمجلات ونحوها</label><label>url: https://raw.githubusercontent.com/OpenITI/0750AH/master/data/0728IbnTaymiyya/0728IbnTaymiyya.JamicMasail/0728IbnTaymiyya.JamicMasail.Sham19Y0016422-ara1</label><label>tok_length: 72633</label><label>status: sec</label><label>id: Sham19Y0016422</label><label>ed_info: محمد عزير شمس :: الأولى، 1432 ه :: دار عالم الفوائد - مكة</label><label>title_lat: Jamic Masail</label><label>title_ar: جامع المسائل - المجموعة الثامنة :: جامع المسائل لابن تيمية ط عالم الفوائد - المجموعة الثامنة</label><label>book: 0728IbnTaymiyya.JamicMasail</label><label>author_lat: Ibn Taymiyya</label><label>author_ar: ابن تيمية :: شيخ الإسلام أحمد بن عبد الحليم بن عبد السلام ابن تيمية</label><label>date: 0728</label><label>versionUri: 0728IbnTaymiyya.JamicMasail.Sham19Y0016422-ara1</label>
</div>
</div>
</div>
<a class="nav-link pull-right" href="#menu-toggle" id="menu-toggle" title="Book Chapters">
<i class="btn bi bi-list"></i></a>
</div>
</div>
</nav>
<div class="book-body fixed pt-5">
<div class="row">
<div class="col-12">
<div class="row top-heading-panel content-outer-spacing">
</div>
</div>
<div class="col-12" id="meta">
</div>
</div>
<div class="row justify-content-md-center" id="book-main">
<div class="col-lg-8 col-sm-12" id="content">
</div>
</div>
<div class="row mt-5" id="footer">
<div class="col-md-12">
            The KITAB project is based at the Institute for the Study of Muslim Civilizations (ISMC) at Aga Khan
            University, London, and has received funding from the European Research Council (ERC) under the European
            Union's
            Horizon 2020 research and innovation programme (Grant agreement No. 772989)

          </div>
<div class="col-md-12">
<img alt="Logos" height="50" id="logos" src="../img/AKU-EU-ERC-three-logos.jpg"/>
</div>
</div>
</div>
</div>
</div>
<script>

    var pageSel = document.getElementById("page-select");
    var volSel = document.getElementById("vol-select");
    var thisVolume = "01";
    var volPages = {"01": ["005", "006", "007", "008", "009", "010", "011", "012", "013", "014", "015", "016", "017", "001", "003", "005", "006", "007", "008", "009", "010", "011", "012", "013", "014", "015", "016", "017", "018", "019", "020", "021", "022", "023", "024", "025", "026", "027", "028", "029", "030", "031", "032", "033", "034", "035", "036", "037", "038", "039", "040", "041", "042", "043", "044", "045", "046", "047", "048", "049", "050", "051", "052", "053", "054", "055", "056", "057", "058", "059", "060", "061", "062", "063", "064", "065", "066", "067", "068", "069", "070", "071", "072", "073", "074", "075", "076", "077", "078", "079", "080", "081", "082", "083", "084", "085", "086", "087", "088", "089", "090", "091", "092", "093", "094", "095", "096", "097", "098", "099", "100", "101", "102", "103", "104", "105", "106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "118", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "130", "131", "132", "133", "134", "135", "136", "137", "138", "139", "140", "141", "142", "143", "144", "145", "146", "147", "148", "149", "150", "151", "152", "153", "154", "155", "156", "157", "158", "159", "160", "161", "162", "163", "164", "165", "166", "167", "168", "169", "170", "171", "172", "173", "174", "175", "176", "177", "178", "179", "180", "181", "183", "184", "185", "186", "187", "188", "189", "190", "191", "192", "193", "194", "195", "196", "197", "198", "199", "201", "202", "203", "204", "205", "206", "207", "208", "209", "210", "211", "212", "213", "214", "215", "216", "217", "219", "221", "222", "223", "224", "225", "226", "227", "228", "229", "230", "231", "232", "233", "234", "235", "237", "238", "239", "240", "241", "242", "243", "244", "245", "246", "247", "248", "249", "250", "251", "252", "253", "254", "255", "256", "257", "258", "259", "260", "261", "262", "263", "264", "265", "266", "267", "268", "269", "271", "272", "273", "274", "275", "276", "277", "278", "279", "280", "281", "282", "283", "284", "285", "286", "287", "288", "289", "290", "291", "292", "293", "294", "295", "296", "297", "298", "299", "300", "301", "302", "303", "304", "305", "306", "307", "308", "309", "310", "311", "312", "313", "314", "315", "316", "317", "318", "319", "320", "321", "322", "323", "324", "325", "326", "327", "328", "329", "330", "331", "333", "334", "335", "336", "337", "338", "339", "340", "341", "342", "343", "344", "345", "346", "347", "348", "349", "350", "351", "352", "353", "354", "355", "356", "357", "358", "359", "361", "363", "364", "365", "366", "367", "368", "369", "370", "371", "372", "373", "374", "375", "376", "377", "378", "379", "380", "381", "382", "383", "384", "385", "386", "387", "388", "389", "390", "391", "392", "393", "395", "396", "397", "398", "399", "400", "401", "402", "403", "405", "407", "408", "409", "410", "411", "412", "413", "415", "416", "417", "418", "419", "420", "421", "422", "423", "425", "427", "428", "429", "430", "431", "432", "433", "434", "435", "436", "437", "438", "439", "440", "441", "442", "443", "444", "445", "446", "447", "448", "449", "450", "451", "452", "453", "013", "096", "198", "235", "281", "282"]}; /*loaded by html_builder*/

    function goToAnchor(vol, anchorId) {
      if (vol != window.thisVolume) {
        loadVolume(vol, false).then(res => {
          console.log("Volume loaded");
          console.log("Go to anchor " + anchorId);
          /*move the volume page to the element with id=anchorId*/
          /*var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
          console.log(targetAnchor);*/
          /*window.location.hash = "";
          window.location.hash = anchorId;
          window.location.hash = anchorId;
          console.log("#"+anchorId);*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = $("#"+anchorId);
          //$("#content").animate(
          $("html, body").animate(
            {scrollTop: targetAnchor.offset().top},
            1000
          );*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = document.getElementById(anchorId);
          var rect = targetAnchor.getBoundingClientRect();
          console.log(targetAnchor);
          console.log(rect);
          var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
          window.scroll({
            top: rect.top + rect.height / 2 - viewHeight /2,
            behavior: 'smooth'
          });*/
          /*var targetAnchor = document.getElementById(anchorId);
          var contentDiv = document.getElementsByClassName("book-body")[0];
          var topPos = contentDiv.offsetTop;
          var windowSize = $(window).height();
          console.log("topPos: " + topPos);
          console.log("targetPos: " + targetAnchor.offsetTop);
          console.log("windowSize:" + windowSize)
          console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
          contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
          var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({"block": "start"});
        });
      } else {
        /*move the volume page to the element with id=anchorId*/
        /*var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
        console.log(targetAnchor);*/
        /*window.location.hash = "";
        window.location.hash = anchorId;
        window.location.hash = anchorId;
        console.log("#"+anchorId);*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = $("#"+anchorId);
        //$("#content").animate(
        $("html, body").animate(
          {scrollTop: targetAnchor.offset().top},
          1000
        );*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = document.getElementById(anchorId);
        var rect = targetAnchor.getBoundingClientRect();
        console.log(targetAnchor);
        console.log(rect);
        var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        window.scroll({
          top: rect.top + rect.height / 2 - viewHeight /2,
          behavior: 'smooth'
        });*/
        /*var targetAnchor = document.getElementById(anchorId);
        var contentDiv = document.getElementsByClassName("book-body")[0];
        var topPos = contentDiv.offsetTop;
        var windowSize = $(window).height();
        console.log("topPos: " + topPos);
        console.log("targetPos: " + targetAnchor.offsetTop);
        console.log("windowSize:" + windowSize)
        console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
        contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
        var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({"block": "start"});
      }
    }

    CollapsibleLists.apply();
    console.log("Applied CollapsibleLists");

    $(document).ready(function () {
      console.log("Load initial volume " + thisVolume);
      loadVolume(thisVolume).then(res => {
        console.log("Initial volume loaded");
        $('#loading').hide();
        $('#loading').fadeOut("slow");
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 50) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });
      // scroll body to 0px on click
      $('#back-to-top').click(function () {
        $('body,html').animate({
          scrollTop: 0
        }, 400);
        return false;
      });
      $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
      });

      $(".font-default").click(function () {

        $('#wrapper').toggleClass("font-increase", "font-default");
      });

      $(".bi-lightbulb-off").click(function () {
        $('.bi-lightbulb-off').toggleClass("bi-lightbulb", "bi-lightbulb-off");
        $('.page-wrapper').toggleClass("night-mode", "");
        $('.navbar-light').toggleClass("night-mode", "");
        console.log(this);

      });
      $('.toc-item').click(function (event) {
        /*console.log('toc item clicked');*/
        event.preventDefault();
        var clickedElement = event.target;
        /*console.log(clickedElement);*/
        var href = clickedElement.getAttribute("href");
        /*console.log('href: '+href);*/
        var vol = href.substring(0, 2);
        var head = href.split('head').pop();
        var anchorId = "head" + head;
        goToAnchor(vol, anchorId);
        return false;
      });
    });

    function loadPageNumbers(vol, page) {
      /*var pageSel = document.getElementById("page-select");*/
      pageSel.innerHTML = '';
      volPages[vol].forEach(function (p, index) {
        pageSel.options[pageSel.options.length] = new Option(p, p);
      });
      if (page) {
        pageSel.value = page;
      }
    }

    function loadVolumeNumbers(vol) {
      /*var volSel = document.getElementById("vol-select");*/
      volSel.innerHTML = '';
      /*console.log(Object.keys(volPages));*/
      /*console.log(Object.keys(volPages).sort());*/

      Object.keys(volPages).sort().forEach(function (v, index) {
        /*console.log(v);*/
        volSel.options[volSel.options.length] = new Option(v, v);
      });
      volSel.value = vol;
    }

    async function loadVolume(vol) {
      /*Load volume json */
      var page = pageSel.value;
      $('#loading').show();
      console.log("loading volume " + vol);
      await $.getJSON(vol + ".json", function (json) {
        console.log(json)
        $('#content').empty().append(json["content"]);
        /*console.log("json loaded");*/
        window.thisVolume = vol;
        $('#loading').hide();
        $('#loading').fadeOut("slow");
        /*Load volume and page numbers in page-nav form:*/
        loadVolumeNumbers(vol);
        loadPageNumbers(vol, page);
        return true;
      });
    }


    function padWithZeros(number, width) {
      number = number + "";
      if (number.length >= width) {
        return number;
      } else {
        return new Array(width - number.length + 1).join("0") + number;
      }
    }
    document.getElementById("nav-form").addEventListener("submit", function (event) {
      event.preventDefault();
      /*console.log("Clicked Go");*/
      var vol = volSel.value;
      console.log("vol: " + vol);
      /*var targetPage = parseInt(pageSel.value, 10);
      if (page >= 1) {
        page = page-1; //page number is at bottom of page
      }
      var anchor = "v"+vol+"p"+padWithZeros(targetPage, 3);*/
      var targetPage = pageSel.value;
      var pages = volPages[vol];
      var index = pages.indexOf(targetPage);
      if (index > 0) {
        targetPage = pages[index-1];
      }

      console.log("targetPage: " + targetPage);
      var anchor = "v" + vol + "p" + targetPage;
      goToAnchor(vol, anchor);
      return false;
    });

    /*Adapt the page numbers list when the volume number changes:*/
    volSel.addEventListener("change", function (event) {
      var vol = this.value;
      var page = pageSel.value;
      loadPageNumbers(vol, page);
    });


  </script>
</body>
</html>
