<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta http-equiv="Content-Security-Policy" https:=""/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri&amp;display=swap" rel="stylesheet"/>
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="../css/stylev2.css" rel="stylesheet" type="text/css"/>
<script crossorigin="anonymous" src="../js/CollapsibleLists.js" type="application/javascript"></script>
<!-- <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/alpheios-components@latest/dist/style/style-components.min.css" /> -->
<script type="text/javascript">
</script>
</head>
<body>
<div id="loading">
<img alt="Loading..." id="loading-image" src="../img/spinner1.gif"/>
</div>
<div class="page-wrapper toggled" id="wrapper">
<div id="sidebar-wrapper">
<html><body><div class="card-header title-heading">فصول الكتاب</div><ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head0">الشيطان داع إلى المعصية</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head1">الذنب لا ينسى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head2">احذر صغائر الذنوب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head3">من سره أن يسبق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head4">التوبة تخلصك من عقاب الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head5">هل الندم توبة؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head6">الحجاج يتحدث عن التوبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head7">حديث الشعراء عن التوبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head8">ركوب الذنوب يميت القلوب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head9">يا مدمن الذنب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head10">أوصى الله إلى داود</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head11">وصية أبى هريرة للفرزدق عن التوبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head12">رؤية المؤمن والمنافق لذنوبهما</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head13">عظمة رحمة رب العالمين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head14">كفارة القبلة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head15">أول رجل قطع في المسلمين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head16">مجادلة العبد ربه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head17">كيف يهون عليك الموت؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head18">الآيات التي يغفر لقارئها:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head19">دعاء آدم وتوبته</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head20">أفضل ما يدخل به اليوم رجل:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head21">الطابع:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head22">الذنوب تطبع على القلوب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head23">تضعيف حسنات التائبين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head24">إن الله ليضاعف الحسنة:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head25">وصية رجل من العباد:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head26">وصية لقمان لابنه:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head27">أكبر أربع كبائر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head28">أنواع الذنوب والمعاصي</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head29">كن حييا:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head30">كفاك:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head31">حال داود عليه السلام في يوم القيامة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head32">موسى يسأل ربه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head33">الذنوب أهم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head34">القصاص في يوم الخلاص</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head35">العصاة أموات على الأرض</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head36">منزلة التائب عند الله تعالى:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head37">أرجى آية في القرآن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head38">إياك والعجب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head39">انشر أعمالك:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head40">احذر مكر الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head41">أدوى الداء الذنوب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head42">كيف تكرم نفسك؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head43">أكرم نفسك بطاعة ربك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head44">ولمن خاف مقام ربه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head45">من آثار المعصية على العبد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head46">ذل المعصية</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head47">الخضر وموسى عليه السلام</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head48">التوبة بالعمل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head49">داود يناجي ربه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head50">إني أذنب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head51">الذنب يصر عليه العبد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head52">عظني:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head53">حق الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head54">احذر الغرور والعجب بالنفس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head55">وتحسبونه هينا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head56">أنوح على نفسي</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head57">مع الصالحين:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head58">إذا ذكرت الخطيئة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head59">على مثل هذا فليبك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head60">آية مغفرة الله للحاج</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head61">من الكبائر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head62">يونس المستغفر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head63">الحياء الحاجز</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head64">دار العفو:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head65">كثرة أستار الله على المؤمن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head66">إذا أراد الله لعبد فضيحة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head67">لا يهتك الله عبدا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head68">خير رجلين في الدنيا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head69">ربكم عز وجل يقول</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head70">كيف تصل إلى مغفرة ذنبك؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head71">أعرابي يتوب إلى ربه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head72">حكم المستغفر وهو مقيم على الذنب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head73">يا أيها الخالي بلذاته</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head74">قضاؤك بي محيط</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head75">الداء والدواء في القرآن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head76">الصراع بين الإنسان والشيطان</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head77">لقد أمهلك ولم يهمك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head78">أول ما في الزبور</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head79">يبكي حتى الصباح</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head80">محمد بن سوقة يتوب توبة نصوحا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head81">من ظلمنا، ومن ظلمناه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head82">لا يتكلم في السنة إلا يوما واحدا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head83">من علامات ارتفاع الخيرية</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head84">أعمال أدق من الشعر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head85">هل في الذنوب مكفرات؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head86">النصيحة لا الفضيحة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head87">إياك وإعانة الشيطان على أخيك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head88">حال من ذكر خطيئة عملها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head89">رجل أحرقته الشمس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head90">متى يعصم العبد من الذنوب؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head91">مثل حديث الناس بالخطيئة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head92">الذكر ذكران</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head93">وهن قلبك من أثر ذنبك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head94">أطيب عند الله من المسك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head95">من مواعظ عيسى عليه السلام</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head96">مكتوب في التوارة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head97">الله أعدل من أن يثني عقوبته</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head98">مثل الذي يعمل السيئات</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head99">حال الإنسان بين الحسنة والسيئة ms24</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head100">توبة ثلاثة من بني إسرائيل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head101">من هو الأواب الحفيظ؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head102">توبة الجهال</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head103">جزاء المعصية</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head104">إذا رضي الله عن عبد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head105">جالسوا التوابين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head106">ود الشيطان لو ظفر منكم بهذه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head107">عاص وطائع في آن واحد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head108">صحيفة ليس فيها استغفار</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head109">آخر وقت تقبل فيه التوبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head110">اتق الله حيثما كنت</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head111">هل تتوب في اليوم مائة مرة؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head112">متى ترد عليك أعمالك؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head113">من أحوال السلف الصالح</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head114">لا تراه إلا باكيا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head115">تعالوا من قبل أن ندرك الكبر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head116">متى تنزل المغفرة؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head117">كان يدعو على الخطائين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head118">علام الغرور وهذا شأنك؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head119">مجلس عبد الله بن مسعود</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head120">أوحى الله إلى الحافظين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head121">ثلاثة لا يلامون</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head122">إذا كثرت ذنوبك ماذا تفعل؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head123">لا إصرار مع الاستغفار</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head124">لا صغيرة مع إصرار</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head125">من فضائل الاستغفار</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head126">أين أنت من الاستغفار؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head127">كيف تحسر الشيطان؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head128">أنا غفار وابن آدم خطاء</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head129">كيف تداوي ذنوبك؟</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head130">محبة الله للشاب التائب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head131">حال جرائم التائبين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head132">متى يكون الذنب أنفع للعبد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head133">احذر أن تبطل عملك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head134">رجل يبني ويهدم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head135">فضل البكاء على الخطيئة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head136">شؤم المعصية وبركة الطاعة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head137">تفسير الران على القلب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head138">عمل الملكين في كل يوم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head139">قالوا لجلودهم</a>
</li>
</ul>
</body></html></div>
<div class="book body-inner" lang="ara">
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" style="direction: ltr;">
<div class="mr-auto d-flex justify-content-left">
<a class="navbar-brand ms-2" href="http://www.kitab-project.org" target="_blank">
<img class="d-inline-block align-top" src="https://cdn.jsdelivr.net/gh/sohailmerchant/kitab-cdn@main/img/kitab-logo.png" width="60px"/>
</a>
</div>
<div class="navbar-nav mx-auto btn-toolbar" style="direction: rtl;">
<div class="d-flex justify-content-center">
<form class="row" id="nav-form" style="margin-bottom: 0px;">
<span class="btn col justify-content-center">ج:</span>
<select class="col form-select pull-left" id="vol-select"></select>
<span class="btn col justify-content-center">ص:</span>
<select class="col form-select pull-left" id="page-select"></select>
<button class="btn col pull-right mx-3" id="nav-submdit-btn" style="width: 100px;" type="submit" value="Go">Go</button>
</form>
</div>
</div>
<div class="btn-toolbar navbar-nav ml-auto d-flex justify-content-right">
<div class="btn-group">
<a class="nav-link pull-right" title="Go to top">
<i class="btn bi bi-arrow-up-circle" id="back-to-top"></i>
</a>
<a class="nav-link pull-right" title="Increase fonts">
<i class="btn bi bi-fonts font-default pull-left"></i>
</a>
<a class="nav-link pull-right" title="Turn light off">
<i class="btn bi bi-lightbulb-off"></i>
</a>
<div class="nav-link pull-right dropdown">
<a aria-expanded="false" aria-haspopup="true" class="" data-bs-toggle="dropdown" id="dropdownMenuButton" role="button" title="Book Metadata">
<i class="btn bi bi-info"></i>
</a>
<div aria-labelledby="dropdownMenuButton" class="dropdown-menu">
<div class="col-12" id="metadata-content"><label>char_length: 40815</label><label>author_lat_full_name: Ibn abī al-dunyā abū bakr ʿabd allāh b. muḥammad b. ʿabīd b. sufyān b. qays al-baġdādī al-qurašī</label><label>author_lat_shuhra: Ibn abī al-dunyā</label><label>author_from_uri: Ibn Abi Dunya</label><label>tags: MARKDOWN :: CENT0300 :: _AKHLAQ :: _IBNABIDUNYA :: GAL@nodata :: Shamela@كتب ابن أبي الدنيا</label><label>url: https://raw.githubusercontent.com/OpenITI/0300AH/master/data/0281IbnAbiDunya/0281IbnAbiDunya.Tawba/0281IbnAbiDunya.Tawba.Shamela0008253-ara1.mARkdown</label><label>tok_length: 10493</label><label>status: pri</label><label>id: Shamela0008253</label><label>ed_info: مجدي السيد إبراهيم. :: مكتبة القرآن، مصر :: http://www.worldcat.org/oclc/4770457051</label><label>title_lat: Tawba</label><label>title_ar: كتاب التوبة.</label><label>book: 0281IbnAbiDunya.Tawba</label><label>author_lat: Ibn Abi Dunya :: Ibn abī al-dunyā :: Ibn abī al-dunyā abū bakr ʿabd allāh b. muḥammad b. ʿabīd b. sufyān b. qays al-baġdādī al-qurašī</label><label>author_ar: إبن أبي الدنيا :: إبن أبي الدنيا أبو بكر عبد ألاه بن محمد بن عبيد بن سفيان بن قيس البغدادي القرشي</label><label>date: 0281</label><label>versionUri: 0281IbnAbiDunya.Tawba.Shamela0008253-ara1</label>
</div>
</div>
</div>
<a class="nav-link pull-right" href="#menu-toggle" id="menu-toggle" title="Book Chapters">
<i class="btn bi bi-list"></i></a>
</div>
</div>
</nav>
<div class="book-body fixed pt-5">
<div class="row">
<div class="col-12">
<div class="row top-heading-panel content-outer-spacing">
</div>
</div>
<div class="col-12" id="meta">
</div>
</div>
<div class="row justify-content-md-center" id="book-main">
<div class="col-lg-8 col-sm-12" id="content">
</div>
</div>
<div class="row mt-5" id="footer">
<div class="col-md-12">
            The KITAB project is based at the Institute for the Study of Muslim Civilizations (ISMC) at Aga Khan
            University, London, and has received funding from the European Research Council (ERC) under the European
            Union's
            Horizon 2020 research and innovation programme (Grant agreement No. 772989)

          </div>
<div class="col-md-12">
<img alt="Logos" height="50" id="logos" src="../img/AKU-EU-ERC-three-logos.jpg"/>
</div>
</div>
</div>
</div>
</div>
<script>

    var pageSel = document.getElementById("page-select");
    var volSel = document.getElementById("vol-select");
    var thisVolume = "01";
    var volPages = {"01": ["000", "030", "000", "031", "000", "031", "000", "032", "000", "033", "000", "034", "000", "035", "000", "035", "000", "036", "000", "036", "000", "000", "037", "000", "038", "000", "039", "000", "041", "000", "042", "000", "043", "000", "044", "000", "045", "000", "046", "000", "047", "000", "048", "000", "049", "000", "049", "000", "000", "051", "000", "052", "000", "053", "000", "053", "000", "000", "054", "000", "055", "000", "056", "000", "000", "000", "057", "000", "000", "058", "000", "059", "000", "059", "000", "060", "000", "061", "000", "000", "062", "000", "063", "000", "064", "000", "000", "065", "000", "065", "000", "066", "000", "066", "000", "067", "000", "067", "000", "068", "000", "069", "000", "069", "000", "069", "000", "070", "000", "071", "000", "072", "000", "072", "000", "073", "000", "073", "000", "074", "000", "000", "075", "000", "075", "000", "076", "000", "076", "000", "076", "000", "000", "077", "000", "078", "000", "000", "079", "000", "079", "000", "080", "000", "081", "000", "082", "000", "082", "000", "083", "000", "000", "084", "000", "085", "000", "086", "000", "087", "000", "000", "000", "000", "088", "000", "089", "000", "089", "000", "000", "000", "000", "000", "000", "091", "000", "000", "000", "093", "000", "000", "094", "000", "095", "000", "000", "095", "000", "000", "096", "000", "000", "097", "000", "098", "000", "098", "000", "099", "000", "100", "000", "000", "101", "000", "000", "102", "000", "103", "000", "000", "000", "104", "000", "000", "000", "106", "000", "000", "107", "000", "108", "000", "109", "000", "000", "110", "000", "111", "000", "000", "112", "000", "113", "000", "114", "000", "114", "000", "115", "000", "116", "000", "116", "000", "117", "000", "000", "000", "119", "000", "119", "000", "120", "000", "120", "000", "121", "000", "122", "000", "000", "123", "000", "123", "000", "124", "000", "124", "000", "125", "000", "000", "125", "000", "126", "000", "000", "000", "000", "128", "000", "000", "000", "129", "000", "130", "000", "130", "000", "000", "131", "000", "132", "000", "132", "000", "000", "134", "000", "134", "000", "135", "000", "000", "000", "000", "136", "000", "000", "137", "000", "138", "000", "138", "000", "138", "000", "139", "000", "000", "000", "140", "000", "000", "141", "000", "000", "000", "142", "000", "000", "000", "000", "000", "144", "000", "000", "145"]}; /*loaded by html_builder*/

    function goToAnchor(vol, anchorId) {
      if (vol != window.thisVolume) {
        loadVolume(vol, false).then(res => {
          console.log("Volume loaded");
          console.log("Go to anchor " + anchorId);
          /*move the volume page to the element with id=anchorId*/
          /*var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
          console.log(targetAnchor);*/
          /*window.location.hash = "";
          window.location.hash = anchorId;
          window.location.hash = anchorId;
          console.log("#"+anchorId);*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = $("#"+anchorId);
          //$("#content").animate(
          $("html, body").animate(
            {scrollTop: targetAnchor.offset().top},
            1000
          );*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = document.getElementById(anchorId);
          var rect = targetAnchor.getBoundingClientRect();
          console.log(targetAnchor);
          console.log(rect);
          var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
          window.scroll({
            top: rect.top + rect.height / 2 - viewHeight /2,
            behavior: 'smooth'
          });*/
          /*var targetAnchor = document.getElementById(anchorId);
          var contentDiv = document.getElementsByClassName("book-body")[0];
          var topPos = contentDiv.offsetTop;
          var windowSize = $(window).height();
          console.log("topPos: " + topPos);
          console.log("targetPos: " + targetAnchor.offsetTop);
          console.log("windowSize:" + windowSize)
          console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
          contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
          var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({"block": "start"});
        });
      } else {
        /*move the volume page to the element with id=anchorId*/
        /*var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
        console.log(targetAnchor);*/
        /*window.location.hash = "";
        window.location.hash = anchorId;
        window.location.hash = anchorId;
        console.log("#"+anchorId);*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = $("#"+anchorId);
        //$("#content").animate(
        $("html, body").animate(
          {scrollTop: targetAnchor.offset().top},
          1000
        );*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = document.getElementById(anchorId);
        var rect = targetAnchor.getBoundingClientRect();
        console.log(targetAnchor);
        console.log(rect);
        var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        window.scroll({
          top: rect.top + rect.height / 2 - viewHeight /2,
          behavior: 'smooth'
        });*/
        /*var targetAnchor = document.getElementById(anchorId);
        var contentDiv = document.getElementsByClassName("book-body")[0];
        var topPos = contentDiv.offsetTop;
        var windowSize = $(window).height();
        console.log("topPos: " + topPos);
        console.log("targetPos: " + targetAnchor.offsetTop);
        console.log("windowSize:" + windowSize)
        console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
        contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
        var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({"block": "start"});
      }
    }

    CollapsibleLists.apply();
    console.log("Applied CollapsibleLists");

    $(document).ready(function () {
      console.log("Load initial volume " + thisVolume);
      loadVolume(thisVolume).then(res => {
        console.log("Initial volume loaded");
        $('#loading').hide();
        $('#loading').fadeOut("slow");
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 50) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });
      // scroll body to 0px on click
      $('#back-to-top').click(function () {
        $('body,html').animate({
          scrollTop: 0
        }, 400);
        return false;
      });
      $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
      });

      $(".font-default").click(function () {

        $('#wrapper').toggleClass("font-increase", "font-default");
      });

      $(".bi-lightbulb-off").click(function () {
        $('.bi-lightbulb-off').toggleClass("bi-lightbulb", "bi-lightbulb-off");
        $('.page-wrapper').toggleClass("night-mode", "");
        $('.navbar-light').toggleClass("night-mode", "");
        console.log(this);

      });
      $('.toc-item').click(function (event) {
        /*console.log('toc item clicked');*/
        event.preventDefault();
        var clickedElement = event.target;
        /*console.log(clickedElement);*/
        var href = clickedElement.getAttribute("href");
        /*console.log('href: '+href);*/
        var vol = href.substring(0, 2);
        var head = href.split('head').pop();
        var anchorId = "head" + head;
        goToAnchor(vol, anchorId);
        return false;
      });
    });

    function loadPageNumbers(vol, page) {
      /*var pageSel = document.getElementById("page-select");*/
      pageSel.innerHTML = '';
      volPages[vol].forEach(function (p, index) {
        pageSel.options[pageSel.options.length] = new Option(p, p);
      });
      if (page) {
        pageSel.value = page;
      }
    }

    function loadVolumeNumbers(vol) {
      /*var volSel = document.getElementById("vol-select");*/
      volSel.innerHTML = '';
      /*console.log(Object.keys(volPages));*/
      /*console.log(Object.keys(volPages).sort());*/

      Object.keys(volPages).sort().forEach(function (v, index) {
        /*console.log(v);*/
        volSel.options[volSel.options.length] = new Option(v, v);
      });
      volSel.value = vol;
    }

    async function loadVolume(vol) {
      /*Load volume json */
      var page = pageSel.value;
      $('#loading').show();
      console.log("loading volume " + vol);
      await $.getJSON(vol + ".json", function (json) {
        console.log(json)
        $('#content').empty().append(json["content"]);
        /*console.log("json loaded");*/
        window.thisVolume = vol;
        $('#loading').hide();
        $('#loading').fadeOut("slow");
        /*Load volume and page numbers in page-nav form:*/
        loadVolumeNumbers(vol);
        loadPageNumbers(vol, page);
        return true;
      });
    }


    function padWithZeros(number, width) {
      number = number + "";
      if (number.length >= width) {
        return number;
      } else {
        return new Array(width - number.length + 1).join("0") + number;
      }
    }
    document.getElementById("nav-form").addEventListener("submit", function (event) {
      event.preventDefault();
      /*console.log("Clicked Go");*/
      var vol = volSel.value;
      console.log("vol: " + vol);
      /*var targetPage = parseInt(pageSel.value, 10);
      if (page >= 1) {
        page = page-1; //page number is at bottom of page
      }
      var anchor = "v"+vol+"p"+padWithZeros(targetPage, 3);*/
      var targetPage = pageSel.value;
      var pages = volPages[vol];
      var index = pages.indexOf(targetPage);
      if (index > 0) {
        targetPage = pages[index-1];
      }

      console.log("targetPage: " + targetPage);
      var anchor = "v" + vol + "p" + targetPage;
      goToAnchor(vol, anchor);
      return false;
    });

    /*Adapt the page numbers list when the volume number changes:*/
    volSel.addEventListener("change", function (event) {
      var vol = this.value;
      var page = pageSel.value;
      loadPageNumbers(vol, page);
    });


  </script>
</body>
</html>
