<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta http-equiv="Content-Security-Policy" https:=""/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri&amp;display=swap" rel="stylesheet"/>
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="../css/stylev2.css" rel="stylesheet" type="text/css"/>
<script crossorigin="anonymous" src="../js/CollapsibleLists.js" type="application/javascript"></script>
<!-- <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/alpheios-components@latest/dist/style/style-components.min.css" /> -->
<script type="text/javascript">
</script>
</head>
<body>
<div id="loading">
<img alt="Loading..." id="loading-image" src="../img/spinner1.gif"/>
</div>
<div class="page-wrapper toggled" id="wrapper">
<div id="sidebar-wrapper">
<html><body><div class="card-header title-heading">فصول الكتاب</div><ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head0">AUTO 1 - مسألة: [الكلام والكلمة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head1">AUTO 2 - مسألة: [حد الاسم]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head2">AUTO 3 - مسألة: [اسمية كيف]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head3">AUTO 4 - مسألة [اشتقاق الاسم]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head4">AUTO 5 - مسألة [حد الفعل]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head5">AUTO 6 - مسألة [أصل الاشتقاق]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head6">AUTO 7 - [مسألة المضاف إلى ياء المتكلم]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head7">AUTO 8 - مسألة [الإعراب أصل في الأسماء]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head8">AUTO 9 - مسألة [علة الإعراب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head9">AUTO 10 - مسألة [علة جعل الإعراب آخر الكلمة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head10">AUTO 11 - مسألة [حقيقة الصرف]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head11">AUTO 12 - مسألة [حقيقة الإعراب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head12">AUTO 13 - مسألة [أيهما أسبق حركات الإعراب أم حركات البناء؟]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head13">AUTO 14 - مسألة [علة زيادة تنوين الصرف]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head14">AUTO 15 - مسألة [فعل الأمر بين البناء والإعراب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head15">AUTO 16 - مسألة [حد الاسم الصحيح]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head16">AUTO 17 - مسألة [إعراب الاسم المنقوص]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head17">AUTO 18 - مسألة [الوقف على المنقوص]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head18">AUTO 19 - مسألة [الوقف على المقصور المنون]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head19">AUTO 20 - مسألة [إعراب الأسماء الستة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head20">AUTO 21 - مسألة [المثنى وجمع المذكر السالم معربان]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head21">AUTO 22 - مسألة [حقيقة حروف التثنية والجمع]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head22">AUTO 23 - مسألة: [تقدير الإعراب على حروف التثنية والجمع]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head23">AUTO 24 - مسألة [النون في التثنية والجمع عوض من الحركة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head24">AUTO 25 - مسألة [تنوين المقابلة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head25">AUTO 26 - مسألة [جمع المذكر الذي فيه تاء التأنيث]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head26">AUTO 27 - مسألة [رافع المبتدأ]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head27">AUTO 28 - مسألة [رافع الخبر]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head28">AUTO 29 - مسألة [العامل في الاسم المرفوع بعد الظرف والجار والمجرور]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head29">AUTO 30 - مسألة [الخبر الجامد لا يحتمل ضميرا]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head30">AUTO 31 - مسألة [الاسم الواقع بعد لولا]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head31">AUTO 32 - مسألة [تقديم خبر المبتدأ]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head32">AUTO 33 - مسألة [متعلق الظرف الواقع خبرا]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head33">AUTO 34 - مسألة [التنازع في العمل]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head34">AUTO 35 - مسألة [إبراز الضمير في اسم الفاعل والصفة المشبهة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head35">AUTO 36 - مسألة [الفعل هو العامل في الفاعل والمفعول]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head36">AUTO 37 - مسألة [الاشتغال]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head37">AUTO 38 - مسألة [نيابة غير المفعول به عن الفاعل]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head38">AUTO 39 - مسألة [إقامة المصدر مقام الفعل]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head39">AUTO 40 - مسألة [نعم وبئس فعلان ماضيان]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head40">AUTO 41 - مسألة [(ما) التعجبية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head41">AUTO 42 - مسألة [فعلية أفعل في التعجب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head42">AUTO 43 - مسألة [التعجب من الألوان]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head43">AUTO 44 - مسألة [المنصوب بكان]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head44">AUTO 45 - مسألة [تقديم خبر ما زال وأخواتها على (ما)]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head45">AUTO 46 - مسألة [(ليس) بين الفعلية والحرفية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head46">AUTO 47 - مسألة [تقديم خبر (ليس) عليها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head47">AUTO 38 - مسألة [خبر (ما) الحجازية منصوب بها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head48">AUTO 49 - مسألة: [تقديم معمول خبر (ما) عليها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head49">AUTO 50 - مسألة [ما طعامك أكل إلا زيد]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head50">AUTO 51 - مسألة [العامل في خبر (إن)]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head51">AUTO 52 - مسألة [العطف على اسم إن قبل الخبر]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head52">AUTO 53 - مسألة [عمل (إن) المخففة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head53">AUTO 54 - مسألة [دخول لام التوكيد في خبر لكن]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head54">AUTO 55 - مسألة [زيادة اللام الأولى في (لعل)]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head55">AUTO 56 - مسألة: [بناء اسم (لا) النافية للجنس]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head56">AUTO 57 - مسألة: [رافع خبر (لا) النافية للجنس]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head57">AUTO 58 - مسألة: [(لا) إذا دخلت على المثنى هل يكون معربا أم مبنيا]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head58">AUTO 59 - مسألة: [تقديم معمول ألفاظ الإغراء عليها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head59">AUTO 60 - [مسألة: ناصب الظرف الواقع خبرا]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head60">AUTO 61 - مسألة: [عامل النصب في المفعول معه]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head61">AUTO 62 - مسألة: [تقديم الحال على العامل فيها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head62">AUTO 63 - مسألة: [وقوع الفعل الماضي حالا]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head63">AUTO 64 - مسألة: [إعراب الظرف الواقع خبرا إذا تكرر بعد اسم الفاعل]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head64">AUTO 65 - مسألة: [تقديم التمييز على العامل فيه]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head65">AUTO 66 - مسألة: [العامل في الاستثناء]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head66">AUTO 67 - مسألة: [وقوع (إلا) بمعنى الواو]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head67">AUTO 68 - مسألة: [تقديم المستثنى مع (إلا)]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head68">AUTO 69 - مسألة: [(حاشا) بين الفعلية والحرفية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head69">AUTO 70 - مسألة: (غير) بين الإعراب والبناء</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head70">AUTO 71 - مسألة: (سوى) لا تقع إلا ظرفا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head71">AUTO 72 - [مسألة: كم مفردة أو مركبة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head72">AUTO 73 - مسألة: [كم الخبرية تجر ما بعدها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head73">AUTO 74 - مسألة: [الفصل بين (كم) وتمييزها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head74">AUTO 75 - مسألة: [إضافة نيف العشرة إليها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head75">AUTO 76 - مسألة: [تعريف العدد المركب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head76">AUTO 77 - مسألة: [إضافة ms126 العدد المركب إلى مثله]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head77">AUTO 78 - مسألة: [المنادى المفرد المعرفة بين البناء والإعراب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head78">AUTO 79 - مسألة: [المنادى المفرد مبني لوقوعه موقع المبني]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head79">AUTO 80 - مسألة: [العامل في المنادى]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head80">AUTO 81 - مسألة: [نداء المحلى بأل]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head81">AUTO 82 - مسألة: [اللهم]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head82">AUTO 83 - مسألة: [ترخيم المضاف]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head83">AUTO 84 - مسألة: [ترخيم الثلاثي]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head84">AUTO 85 - مسألة: [ترخيم الرباعي]</a>
</li>
</ul>
</body></html></div>
<div class="book body-inner" lang="ara">
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" style="direction: ltr;">
<div class="mr-auto d-flex justify-content-left">
<a class="navbar-brand ms-2" href="http://www.kitab-project.org" target="_blank">
<img class="d-inline-block align-top" src="https://cdn.jsdelivr.net/gh/sohailmerchant/kitab-cdn@main/img/kitab-logo.png" width="60px"/>
</a>
</div>
<div class="navbar-nav mx-auto btn-toolbar" style="direction: rtl;">
<div class="d-flex justify-content-center">
<form class="row" id="nav-form" style="margin-bottom: 0px;">
<span class="btn col justify-content-center">ج:</span>
<select class="col form-select pull-left" id="vol-select"></select>
<span class="btn col justify-content-center">ص:</span>
<select class="col form-select pull-left" id="page-select"></select>
<button class="btn col pull-right mx-3" id="nav-submdit-btn" style="width: 100px;" type="submit" value="Go">Go</button>
</form>
</div>
</div>
<div class="btn-toolbar navbar-nav ml-auto d-flex justify-content-right">
<div class="btn-group">
<a class="nav-link pull-right" title="Go to top">
<i class="btn bi bi-arrow-up-circle" id="back-to-top"></i>
</a>
<a class="nav-link pull-right" title="Increase fonts">
<i class="btn bi bi-fonts font-default pull-left"></i>
</a>
<a class="nav-link pull-right" title="Turn light off">
<i class="btn bi bi-lightbulb-off"></i>
</a>
<div class="nav-link pull-right dropdown">
<a aria-expanded="false" aria-haspopup="true" class="" data-bs-toggle="dropdown" id="dropdownMenuButton" role="button" title="Book Metadata">
<i class="btn bi bi-info"></i>
</a>
<div aria-labelledby="dropdownMenuButton" class="dropdown-menu">
<div class="col-12" id="metadata-content"><label>char_length: 166001</label><label>author_lat_full_name: </label><label>author_lat_shuhra: </label><label>author_from_uri: Muhibb Din Cukbari</label><label>tags:  :: Sham@النحو والصرف</label><label>url: https://raw.githubusercontent.com/OpenITI/0625AH/master/data/0616MuhibbDinCukbari/0616MuhibbDinCukbari.TibyanFiIcrabQuran/0616MuhibbDinCukbari.TibyanFiIcrabQuran.Sham19Y0013786-ara1</label><label>tok_length: 40263</label><label>status: sec</label><label>id: Sham19Y0013786</label><label>ed_info: د. عبد الرحمن العثيمين :: الأولى، 1406ه - 1986م :: دار الغرب الإسلامي</label><label>title_lat: Tibyan Fi Icrab Quran</label><label>title_ar: التبيين عن مذاهب النحويين البصريين والكوفيين :: التبيين عن مذاهب النحويين</label><label>book: 0616MuhibbDinCukbari.TibyanFiIcrabQuran</label><label>author_lat: Muhibb Din Cukbari</label><label>author_ar: العكبري، أبو البقاء :: أبو البقاء عبد الله بن الحسين بن عبد الله العكبري البغدادي محب الدين (المتوفى: 616ه)</label><label>date: 0616</label><label>versionUri: 0616MuhibbDinCukbari.TibyanFiIcrabQuran.Sham19Y0013786-ara1</label>
</div>
</div>
</div>
<a class="nav-link pull-right" href="#menu-toggle" id="menu-toggle" title="Book Chapters">
<i class="btn bi bi-list"></i></a>
</div>
</div>
</nav>
<div class="book-body fixed pt-5">
<div class="row">
<div class="col-12">
<div class="row top-heading-panel content-outer-spacing">
</div>
</div>
<div class="col-12" id="meta">
</div>
</div>
<div class="row justify-content-md-center" id="book-main">
<div class="col-lg-8 col-sm-12" id="content">
</div>
</div>
<div class="row mt-5" id="footer">
<div class="col-md-12">
            The KITAB project is based at the Institute for the Study of Muslim Civilizations (ISMC) at Aga Khan
            University, London, and has received funding from the European Research Council (ERC) under the European
            Union's
            Horizon 2020 research and innovation programme (Grant agreement No. 772989)

          </div>
<div class="col-md-12">
<img alt="Logos" height="50" id="logos" src="../img/AKU-EU-ERC-three-logos.jpg"/>
</div>
</div>
</div>
</div>
</div>
<script>

    var pageSel = document.getElementById("page-select");
    var volSel = document.getElementById("vol-select");
    var thisVolume = "01";
    var volPages = {"01": ["111", "113", "114", "115", "116", "117", "118", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "130", "131", "132", "133", "134", "135", "136", "137", "138", "139", "140", "141", "142", "143", "144", "145", "146", "147", "148", "149", "150", "151", "152", "153", "154", "155", "156", "157", "158", "159", "160", "161", "162", "163", "164", "165", "166", "167", "168", "169", "170", "171", "172", "173", "174", "175", "176", "177", "178", "179", "180", "181", "182", "183", "184", "185", "186", "187", "188", "189", "190", "191", "192", "193", "194", "195", "196", "197", "198", "199", "200", "201", "202", "203", "204", "205", "206", "207", "208", "209", "210", "211", "212", "213", "214", "215", "216", "217", "218", "219", "220", "221", "222", "223", "224", "225", "226", "227", "228", "229", "230", "231", "232", "233", "234", "235", "236", "237", "238", "239", "240", "241", "242", "243", "244", "245", "246", "247", "248", "249", "250", "251", "252", "253", "254", "255", "256", "257", "258", "259", "260", "261", "262", "263", "264", "265", "266", "267", "268", "269", "270", "271", "272", "273", "274", "275", "276", "277", "278", "279", "280", "281", "282", "283", "284", "285", "286", "287", "288", "289", "290", "291", "292", "293", "294", "295", "296", "297", "298", "299", "300", "301", "302", "303", "304", "305", "306", "307", "308", "309", "310", "311", "312", "313", "314", "315", "316", "317", "318", "319", "320", "321", "322", "323", "324", "325", "326", "327", "328", "329", "330", "331", "332", "333", "334", "335", "336", "337", "338", "339", "340", "341", "342", "343", "344", "345", "346", "347", "348", "349", "350", "351", "352", "353", "354", "355", "356", "357", "358", "359", "360", "361", "362", "363", "364", "365", "366", "367", "368", "369", "370", "371", "372", "373", "374", "375", "376", "377", "378", "379", "380", "381", "382", "383", "384", "385", "386", "387", "388", "389", "390", "391", "392", "393", "394", "395", "396", "397", "398", "399", "400", "401", "402", "403", "404", "405", "406", "407", "408", "409", "410", "411", "412", "413", "414", "415", "416", "417", "418", "419", "420", "421", "422", "423", "424", "425", "426", "427", "428", "429", "430", "431", "432", "433", "434", "435", "436", "437", "438", "439", "440", "441", "442", "443", "444", "445", "446", "447", "448", "449", "450", "451", "452", "453", "454", "455", "456", "457", "458"]}; /*loaded by html_builder*/

    function goToAnchor(vol, anchorId) {
      if (vol != window.thisVolume) {
        loadVolume(vol, false).then(res => {
          console.log("Volume loaded");
          console.log("Go to anchor " + anchorId);
          /*move the volume page to the element with id=anchorId*/
          /*var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
          console.log(targetAnchor);*/
          /*window.location.hash = "";
          window.location.hash = anchorId;
          window.location.hash = anchorId;
          console.log("#"+anchorId);*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = $("#"+anchorId);
          //$("#content").animate(
          $("html, body").animate(
            {scrollTop: targetAnchor.offset().top},
            1000
          );*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = document.getElementById(anchorId);
          var rect = targetAnchor.getBoundingClientRect();
          console.log(targetAnchor);
          console.log(rect);
          var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
          window.scroll({
            top: rect.top + rect.height / 2 - viewHeight /2,
            behavior: 'smooth'
          });*/
          /*var targetAnchor = document.getElementById(anchorId);
          var contentDiv = document.getElementsByClassName("book-body")[0];
          var topPos = contentDiv.offsetTop;
          var windowSize = $(window).height();
          console.log("topPos: " + topPos);
          console.log("targetPos: " + targetAnchor.offsetTop);
          console.log("windowSize:" + windowSize)
          console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
          contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
          var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({"block": "start"});
        });
      } else {
        /*move the volume page to the element with id=anchorId*/
        /*var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
        console.log(targetAnchor);*/
        /*window.location.hash = "";
        window.location.hash = anchorId;
        window.location.hash = anchorId;
        console.log("#"+anchorId);*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = $("#"+anchorId);
        //$("#content").animate(
        $("html, body").animate(
          {scrollTop: targetAnchor.offset().top},
          1000
        );*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = document.getElementById(anchorId);
        var rect = targetAnchor.getBoundingClientRect();
        console.log(targetAnchor);
        console.log(rect);
        var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        window.scroll({
          top: rect.top + rect.height / 2 - viewHeight /2,
          behavior: 'smooth'
        });*/
        /*var targetAnchor = document.getElementById(anchorId);
        var contentDiv = document.getElementsByClassName("book-body")[0];
        var topPos = contentDiv.offsetTop;
        var windowSize = $(window).height();
        console.log("topPos: " + topPos);
        console.log("targetPos: " + targetAnchor.offsetTop);
        console.log("windowSize:" + windowSize)
        console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
        contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
        var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({"block": "start"});
      }
    }

    CollapsibleLists.apply();
    console.log("Applied CollapsibleLists");

    $(document).ready(function () {
      console.log("Load initial volume " + thisVolume);
      loadVolume(thisVolume).then(res => {
        console.log("Initial volume loaded");
        $('#loading').hide();
        $('#loading').fadeOut("slow");
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 50) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });
      // scroll body to 0px on click
      $('#back-to-top').click(function () {
        $('body,html').animate({
          scrollTop: 0
        }, 400);
        return false;
      });
      $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
      });

      $(".font-default").click(function () {

        $('#wrapper').toggleClass("font-increase", "font-default");
      });

      $(".bi-lightbulb-off").click(function () {
        $('.bi-lightbulb-off').toggleClass("bi-lightbulb", "bi-lightbulb-off");
        $('.page-wrapper').toggleClass("night-mode", "");
        $('.navbar-light').toggleClass("night-mode", "");
        console.log(this);

      });
      $('.toc-item').click(function (event) {
        /*console.log('toc item clicked');*/
        event.preventDefault();
        var clickedElement = event.target;
        /*console.log(clickedElement);*/
        var href = clickedElement.getAttribute("href");
        /*console.log('href: '+href);*/
        var vol = href.substring(0, 2);
        var head = href.split('head').pop();
        var anchorId = "head" + head;
        goToAnchor(vol, anchorId);
        return false;
      });
    });

    function loadPageNumbers(vol, page) {
      /*var pageSel = document.getElementById("page-select");*/
      pageSel.innerHTML = '';
      volPages[vol].forEach(function (p, index) {
        pageSel.options[pageSel.options.length] = new Option(p, p);
      });
      if (page) {
        pageSel.value = page;
      }
    }

    function loadVolumeNumbers(vol) {
      /*var volSel = document.getElementById("vol-select");*/
      volSel.innerHTML = '';
      /*console.log(Object.keys(volPages));*/
      /*console.log(Object.keys(volPages).sort());*/

      Object.keys(volPages).sort().forEach(function (v, index) {
        /*console.log(v);*/
        volSel.options[volSel.options.length] = new Option(v, v);
      });
      volSel.value = vol;
    }

    async function loadVolume(vol) {
      /*Load volume json */
      var page = pageSel.value;
      $('#loading').show();
      console.log("loading volume " + vol);
      await $.getJSON(vol + ".json", function (json) {
        console.log(json)
        $('#content').empty().append(json["content"]);
        /*console.log("json loaded");*/
        window.thisVolume = vol;
        $('#loading').hide();
        $('#loading').fadeOut("slow");
        /*Load volume and page numbers in page-nav form:*/
        loadVolumeNumbers(vol);
        loadPageNumbers(vol, page);
        return true;
      });
    }


    function padWithZeros(number, width) {
      number = number + "";
      if (number.length >= width) {
        return number;
      } else {
        return new Array(width - number.length + 1).join("0") + number;
      }
    }
    document.getElementById("nav-form").addEventListener("submit", function (event) {
      event.preventDefault();
      /*console.log("Clicked Go");*/
      var vol = volSel.value;
      console.log("vol: " + vol);
      /*var targetPage = parseInt(pageSel.value, 10);
      if (page >= 1) {
        page = page-1; //page number is at bottom of page
      }
      var anchor = "v"+vol+"p"+padWithZeros(targetPage, 3);*/
      var targetPage = pageSel.value;
      var pages = volPages[vol];
      var index = pages.indexOf(targetPage);
      if (index > 0) {
        targetPage = pages[index-1];
      }

      console.log("targetPage: " + targetPage);
      var anchor = "v" + vol + "p" + targetPage;
      goToAnchor(vol, anchor);
      return false;
    });

    /*Adapt the page numbers list when the volume number changes:*/
    volSel.addEventListener("change", function (event) {
      var vol = this.value;
      var page = pageSel.value;
      loadPageNumbers(vol, page);
    });


  </script>
</body>
</html>
