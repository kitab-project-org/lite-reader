<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta http-equiv="Content-Security-Policy" https:=""/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri&amp;display=swap" rel="stylesheet"/>
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="../css/stylev2.css" rel="stylesheet" type="text/css"/>
<script crossorigin="anonymous" src="../js/CollapsibleLists.js" type="application/javascript"></script>
<!-- <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/alpheios-components@latest/dist/style/style-components.min.css" /> -->
<script type="text/javascript">
</script>
</head>
<body>
<div id="loading">
<img alt="Loading..." id="loading-image" src="../img/spinner1.gif"/>
</div>
<div class="page-wrapper toggled" id="wrapper">
<div id="sidebar-wrapper">
<html><body><div class="card-header title-heading">فصول الكتاب</div><ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head0"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head1">[الابتداء بالحمدلة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head2">[عجز الحريري عن إنشاء ما طلب منه في الديوان]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head3">[ثقافة الكاتب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head4">[هل تضر مخالفة النحو في معنى]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head5">[هل يقدح اللحن في حسن الكلام]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head6">[حول لون البقرة في الآية صفراء فاقع لونها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head7">[التأدب في الحديث عن العظماء]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head8">[إنكار التلقب بالناصر على السلطان صلاح الدين]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head9">[رسالة ابن زيادة البغدادي]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head10">[البلاغة والفصاحة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head11">[تحديد معنى البلاغة والفصاحة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head12">[أقسام علم البيان]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head13">الاستعارة والكناية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head14">[تعليلات النحاة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head15">[ما يشترك فيه الكاتب والشاعر]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head16">[كيف يستفيد الكاتب المنشىء من التراث الأدبي]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head17">[الصفدي ينتقد ابن الأثير في بعض من إنشائه]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head18">[ادعاء ابن الأثير الإبداع في رسالة له في ذم الشيب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head19">[مناقشة مثال لابن الأثير]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head20">[مناقشة مثال آخر لابن الأثير]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head21">[نماذج من إنشاء ابن الأثير والنقاش حولها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head22">[مناسبة اللفظ للمعنى]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head23">[اللفظ والتركيب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head24">[هل سورة النجم مسجوعة على حرف الياء]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head25">[مناسبة اللفظ للمعنى ونماذج من خطب ابن نباته]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head26">[الموضوعات والألفاظ]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head27">[مناسبة اللفظ للسجع]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head28">[مناقشة حول معنى أخطا فيه ابن الأثير في إنشائه]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head29">[عودة إلى الإبتداء بالحمد]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head30">[أقسام التصريع]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head31">[كلامه على التجنيس]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head32">[التجنيس المعكوس]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head33">[التجنيس المجنب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head34">[لزوم ما لا يلزم]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head35">[مناقشة حول معنى أخطأ ابن الأثير فيه في إنشائه]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head36">[لفظة خود متى تكون حسنة أو قبيحة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head37">[هل كلمة الإمة بالكسر فصيحة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head38">[حول المعاظلة اللفظية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head39">[من أنواع المعاظلة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head40">[رد التعصب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head41">[حول وصل همزة القطع وقطع همزة الوصل]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head42">[الصناعة المعنوية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head43">[هل صح اطلاع بعض الشعراء والكتاب على حكم اليونان وعلومهم]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head44">[شاهد الحال ودوره في استخراج المعاني]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head45">[فضل المتنبي في لاميته في خيمة سيف الدولة]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head46">[هل أبدع أبو نواس في أبياته تدار علينا الراح في عسجدية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head47">[هل يمكن إبداع معنى من معنى غير مبتدع]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head48">[مناقشة نموذج من إنشاء ابن الأثير]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head49">[نماذج من إنشاء ابن الأثير يدعي فيها التقدم]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head50">[الحسن في أبيات ابن بقي بأبي غزال غازلته مقلتي]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head51">[أحسن ما قيل في الخمر وكأسها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head52">[نماذج من إنشاء ابن الأثير يدعي فيها السمو]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head53">[نموذج من إنشاء ابن الأثير في ذم الشيب يدعي فيه الإبداع]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head54">[مناقشة نموذج من إنشاء ابن الأثير]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head55">[نموذج من إنشاء ابن الأثير يدعي فيه الإبداع]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head56">[مناقشة رسالة لابن الأثير من عاشق إلى معشوق]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head57">[مناقشة نموذج من إنشاء ابن الأثير]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head58">[رسالة لابن الأثير في وصف قسي البندق وحامليها]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head59">[هل من شرط بلاغة التشبيه أن يشبه الشيء بما هو أكبر منه وأعظم]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head60">[مناقشة حول التشبيه في أبيات أحد الشعراء]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head61">[مناقشة نماذج من التشبه من إنشاء ابن الأثير]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head62">[براعة التشبيه في بيت للبحتري]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head63">[مناقشة نموذج آخر من إنشاء ابن الأثير]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head64">[الالتفات في بعض الآيات]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head65">[اقحام النحو]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head66">[حول توكيد الضميرين]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head67">[ابن الأثير يناقش المتنبي في بعض شعره]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head68">[حول ورود أن بعد لما وأثرها في الدلالة على تراخي الزمن]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head69">[حول الاعتراض]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head70">[حول الكناية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head71">[حول المغالطات المعنوية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head72">[الأحاجي والمغالطات في مقامات الحريري]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head73">[الفرق بين الإلغاز والوصف أمثلة من وصف السفن]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head74">[مناقشة الصفدي لابن الأثير في تعليقه على لغز في حمام]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head75">[من أقوالهم في الحمام]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head76">[أمثلة على الألغاز الحسان ومناقشة الفرق بين اللغز والتعريض]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head77">[الفرق بين اللغز والتعريض]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head78">[المبادىء والافتتاحات]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head79">[من المحاسن افتتاح الكتاب بآية أو حديث أو بيت شعر]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head80">[في التخلص والاقتضاب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head81">[التخلص ms167 في القرآن الكريم]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head82">[حول أمثلة من ذلك أوردها ابن الأثير من القرآن الكريم]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head83">[نماذج من التخلص في إنشاء ابن الأثير]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head84">[التناسب بين المعاني ومناقشة أمثلة من ذلك]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head85">[مناقشة ابن الأثير في الاقتصاد والتفريط والإفراط]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head86">[المفاضلة بين التسميتين الإرصاد والتوشيح]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head87">[حول السرقات الشعرية]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head88">[الاقتصاد في اللفظ]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head89">[بين النثر والنظم]</a>
</li>
</ul>
</body></html></div>
<div class="book body-inner" lang="ara">
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" style="direction: ltr;">
<div class="mr-auto d-flex justify-content-left">
<a class="navbar-brand ms-2" href="http://www.kitab-project.org" target="_blank">
<img class="d-inline-block align-top" src="https://cdn.jsdelivr.net/gh/sohailmerchant/kitab-cdn@main/img/kitab-logo.png" width="60px"/>
</a>
</div>
<div class="navbar-nav mx-auto btn-toolbar" style="direction: rtl;">
<div class="d-flex justify-content-center">
<form class="row" id="nav-form" style="margin-bottom: 0px;">
<span class="btn col justify-content-center">ج:</span>
<select class="col form-select pull-left" id="vol-select"></select>
<span class="btn col justify-content-center">ص:</span>
<select class="col form-select pull-left" id="page-select"></select>
<button class="btn col pull-right mx-3" id="nav-submdit-btn" style="width: 100px;" type="submit" value="Go">Go</button>
</form>
</div>
</div>
<div class="btn-toolbar navbar-nav ml-auto d-flex justify-content-right">
<div class="btn-group">
<a class="nav-link pull-right" title="Go to top">
<i class="btn bi bi-arrow-up-circle" id="back-to-top"></i>
</a>
<a class="nav-link pull-right" title="Increase fonts">
<i class="btn bi bi-fonts font-default pull-left"></i>
</a>
<a class="nav-link pull-right" title="Turn light off">
<i class="btn bi bi-lightbulb-off"></i>
</a>
<div class="nav-link pull-right dropdown">
<a aria-expanded="false" aria-haspopup="true" class="" data-bs-toggle="dropdown" id="dropdownMenuButton" role="button" title="Book Metadata">
<i class="btn bi bi-info"></i>
</a>
<div aria-labelledby="dropdownMenuButton" class="dropdown-menu">
<div class="col-12" id="metadata-content"><label>char_length: 228379</label><label>author_lat_full_name: </label><label>author_lat_shuhra: </label><label>author_from_uri: Safadi</label><label>tags: COMPLETED :: CENT0800 :: _ADAB :: _AMTHAL :: _BALAGHA :: GAL@historiography :: GAL@literature-islamic :: GAL@history :: GAL@period-postmongol :: GAL@period-mamluk :: GAL@1258-1517CE :: GAL@period-decline :: GAL@biography-collective :: GAL@biography :: GAL@egypt :: GAL@syria :: Shamela@الأدب والبلاغة - مرقم آليا</label><label>url: https://raw.githubusercontent.com/OpenITI/0775AH/master/data/0764Safadi/0764Safadi.NusratThair/0764Safadi.NusratThair.Shamela0000514-ara1.completed</label><label>tok_length: 54756</label><label>status: pri</label><label>id: Shamela0000514</label><label>ed_info: http://www.worldcat.org/oclc/583168739</label><label>title_lat: Nusrat Thair</label><label>title_ar: نصرة الثائر على المثل السائر</label><label>book: 0764Safadi.NusratThair</label><label>author_lat: Safadi</label><label>author_ar: صلاح الدين خليل بن أيبك الصفدي (المتوفى: 764هـ)</label><label>date: 0764</label><label>versionUri: 0764Safadi.NusratThair.Shamela0000514-ara1</label>
</div>
</div>
</div>
<a class="nav-link pull-right" href="#menu-toggle" id="menu-toggle" title="Book Chapters">
<i class="btn bi bi-list"></i></a>
</div>
</div>
</nav>
<div class="book-body fixed pt-5">
<div class="row">
<div class="col-12">
<div class="row top-heading-panel content-outer-spacing">
</div>
</div>
<div class="col-12" id="meta">
</div>
</div>
<div class="row justify-content-md-center" id="book-main">
<div class="col-lg-8 col-sm-12" id="content">
</div>
</div>
<div class="row mt-5" id="footer">
<div class="col-md-12">
            The KITAB project is based at the Institute for the Study of Muslim Civilizations (ISMC) at Aga Khan
            University, London, and has received funding from the European Research Council (ERC) under the European
            Union's
            Horizon 2020 research and innovation programme (Grant agreement No. 772989)

          </div>
<div class="col-md-12">
<img alt="Logos" height="50" id="logos" src="../img/AKU-EU-ERC-three-logos.jpg"/>
</div>
</div>
</div>
</div>
</div>
<script>

    var pageSel = document.getElementById("page-select");
    var volSel = document.getElementById("vol-select");
    var thisVolume = "01";
    var volPages = {"01": ["000", "001", "002", "003", "004", "005", "006", "007", "008", "009", "010", "011", "012", "013", "014", "015", "016", "017", "018", "019", "020", "021", "022", "023", "024", "025", "026", "027", "028", "029", "030", "031", "032", "033", "034", "035", "036", "037", "038", "039", "040", "041", "042", "043", "044", "045", "046", "047", "048", "049", "050", "051", "052", "053", "054", "055", "056", "057", "058", "059", "060", "061", "062", "063", "064", "065", "066", "067", "068", "069", "070", "071", "072", "073", "074", "075", "076", "077", "078", "079", "080", "081", "082", "083", "084", "085", "086", "087", "088", "089", "090", "091", "092", "093", "094", "095", "096", "097"]}; /*loaded by html_builder*/

    function goToAnchor(vol, anchorId) {
      if (vol != window.thisVolume) {
        loadVolume(vol, false).then(res => {
          console.log("Volume loaded");
          console.log("Go to anchor " + anchorId);
          /*move the volume page to the element with id=anchorId*/
          /*var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
          console.log(targetAnchor);*/
          /*window.location.hash = "";
          window.location.hash = anchorId;
          window.location.hash = anchorId;
          console.log("#"+anchorId);*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = $("#"+anchorId);
          //$("#content").animate(
          $("html, body").animate(
            {scrollTop: targetAnchor.offset().top},
            1000
          );*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = document.getElementById(anchorId);
          var rect = targetAnchor.getBoundingClientRect();
          console.log(targetAnchor);
          console.log(rect);
          var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
          window.scroll({
            top: rect.top + rect.height / 2 - viewHeight /2,
            behavior: 'smooth'
          });*/
          /*var targetAnchor = document.getElementById(anchorId);
          var contentDiv = document.getElementsByClassName("book-body")[0];
          var topPos = contentDiv.offsetTop;
          var windowSize = $(window).height();
          console.log("topPos: " + topPos);
          console.log("targetPos: " + targetAnchor.offsetTop);
          console.log("windowSize:" + windowSize)
          console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
          contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
          var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({"block": "start"});
        });
      } else {
        /*move the volume page to the element with id=anchorId*/
        /*var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
        console.log(targetAnchor);*/
        /*window.location.hash = "";
        window.location.hash = anchorId;
        window.location.hash = anchorId;
        console.log("#"+anchorId);*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = $("#"+anchorId);
        //$("#content").animate(
        $("html, body").animate(
          {scrollTop: targetAnchor.offset().top},
          1000
        );*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = document.getElementById(anchorId);
        var rect = targetAnchor.getBoundingClientRect();
        console.log(targetAnchor);
        console.log(rect);
        var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        window.scroll({
          top: rect.top + rect.height / 2 - viewHeight /2,
          behavior: 'smooth'
        });*/
        /*var targetAnchor = document.getElementById(anchorId);
        var contentDiv = document.getElementsByClassName("book-body")[0];
        var topPos = contentDiv.offsetTop;
        var windowSize = $(window).height();
        console.log("topPos: " + topPos);
        console.log("targetPos: " + targetAnchor.offsetTop);
        console.log("windowSize:" + windowSize)
        console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
        contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
        var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({"block": "start"});
      }
    }

    CollapsibleLists.apply();
    console.log("Applied CollapsibleLists");

    $(document).ready(function () {
      console.log("Load initial volume " + thisVolume);
      loadVolume(thisVolume).then(res => {
        console.log("Initial volume loaded");
        $('#loading').hide();
        $('#loading').fadeOut("slow");
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 50) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });
      // scroll body to 0px on click
      $('#back-to-top').click(function () {
        $('body,html').animate({
          scrollTop: 0
        }, 400);
        return false;
      });
      $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
      });

      $(".font-default").click(function () {

        $('#wrapper').toggleClass("font-increase", "font-default");
      });

      $(".bi-lightbulb-off").click(function () {
        $('.bi-lightbulb-off').toggleClass("bi-lightbulb", "bi-lightbulb-off");
        $('.page-wrapper').toggleClass("night-mode", "");
        $('.navbar-light').toggleClass("night-mode", "");
        console.log(this);

      });
      $('.toc-item').click(function (event) {
        /*console.log('toc item clicked');*/
        event.preventDefault();
        var clickedElement = event.target;
        /*console.log(clickedElement);*/
        var href = clickedElement.getAttribute("href");
        /*console.log('href: '+href);*/
        var vol = href.substring(0, 2);
        var head = href.split('head').pop();
        var anchorId = "head" + head;
        goToAnchor(vol, anchorId);
        return false;
      });
    });

    function loadPageNumbers(vol, page) {
      /*var pageSel = document.getElementById("page-select");*/
      pageSel.innerHTML = '';
      volPages[vol].forEach(function (p, index) {
        pageSel.options[pageSel.options.length] = new Option(p, p);
      });
      if (page) {
        pageSel.value = page;
      }
    }

    function loadVolumeNumbers(vol) {
      /*var volSel = document.getElementById("vol-select");*/
      volSel.innerHTML = '';
      /*console.log(Object.keys(volPages));*/
      /*console.log(Object.keys(volPages).sort());*/

      Object.keys(volPages).sort().forEach(function (v, index) {
        /*console.log(v);*/
        volSel.options[volSel.options.length] = new Option(v, v);
      });
      volSel.value = vol;
    }

    async function loadVolume(vol) {
      /*Load volume json */
      var page = pageSel.value;
      $('#loading').show();
      console.log("loading volume " + vol);
      await $.getJSON(vol + ".json", function (json) {
        console.log(json)
        $('#content').empty().append(json["content"]);
        /*console.log("json loaded");*/
        window.thisVolume = vol;
        $('#loading').hide();
        $('#loading').fadeOut("slow");
        /*Load volume and page numbers in page-nav form:*/
        loadVolumeNumbers(vol);
        loadPageNumbers(vol, page);
        return true;
      });
    }


    function padWithZeros(number, width) {
      number = number + "";
      if (number.length >= width) {
        return number;
      } else {
        return new Array(width - number.length + 1).join("0") + number;
      }
    }
    document.getElementById("nav-form").addEventListener("submit", function (event) {
      event.preventDefault();
      /*console.log("Clicked Go");*/
      var vol = volSel.value;
      console.log("vol: " + vol);
      /*var targetPage = parseInt(pageSel.value, 10);
      if (page >= 1) {
        page = page-1; //page number is at bottom of page
      }
      var anchor = "v"+vol+"p"+padWithZeros(targetPage, 3);*/
      var targetPage = pageSel.value;
      var pages = volPages[vol];
      var index = pages.indexOf(targetPage);
      if (index > 0) {
        targetPage = pages[index-1];
      }

      console.log("targetPage: " + targetPage);
      var anchor = "v" + vol + "p" + targetPage;
      goToAnchor(vol, anchor);
      return false;
    });

    /*Adapt the page numbers list when the volume number changes:*/
    volSel.addEventListener("change", function (event) {
      var vol = this.value;
      var page = pageSel.value;
      loadPageNumbers(vol, page);
    });


  </script>
</body>
</html>
