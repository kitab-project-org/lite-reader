<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta http-equiv="Content-Security-Policy" https:=""/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri&amp;display=swap" rel="stylesheet"/>
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="../css/stylev2.css" rel="stylesheet" type="text/css"/>
<script crossorigin="anonymous" src="../js/CollapsibleLists.js" type="application/javascript"></script>
<!-- <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/alpheios-components@latest/dist/style/style-components.min.css" /> -->
<script type="text/javascript">
</script>
</head>
<body>
<div id="loading">
<img alt="Loading..." id="loading-image" src="../img/spinner1.gif"/>
</div>
<div class="page-wrapper toggled" id="wrapper">
<div id="sidebar-wrapper">
<html><body><div class="card-header title-heading">فصول الكتاب</div><ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head0">CHECK [أول الكتاب]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head1">AUTO فصل وقد سلك جماهير العقلاء في هذا الباب في كل واد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head2">AUTO ### | AUTO ### | AUTO ### | AUTO ### | AUTO ### | AUTO ### |</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head3">AUTO ### | AUTO ### | AUTO ### | AUTO ### | AUTO فصل ولما</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head4">AUTO ### | AUTO الباب الرابع والعشرون في معنى قول السلف في</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head5">AUTO الباب السابع والعشرون في دخول الإيمان بالقضاء والقدر والعدل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head6">AUTO فلا تعجل بإنكار ما لم يتقدم لك أسباب معرفته ولا يحملنك شنآن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head7">AUTO الباب الثاني في تقدير الرب تبارك وتعالى شقاوة العباد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head8">AUTO الباب الثالث في ذكر احتجاج آدم وموسى في ذلك حكم النبي صلى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head9">AUTO الباب الخامس في ذكر التقدير الرابع ليلة القدر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head10">AUTO الباب السابع في أن سبق المقادير بالشقاوة والسعادة لا يقضي</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head11">AUTO الباب الثامن في قوله تعالى إن الذين سبقت لهم منا الحسنى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head12">AUTO الباب التاسع في قوله تعالى إنا كل شيء خلقناه بقدر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head13">AUTO الباب العاشر في مراتب القضاء والقدر التي من لم يؤمن بها لم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head14">AUTO الفرقان وضياء وذكرا للمتقين وقال وهذا ذكر مبارك أنزلناه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head15">AUTO ومما يناسب هذا قوله تعالى لقد صدق الله ورسوله الرؤيا بالحق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head16">AUTO فصل وفي قوله تعالى وأضله الله على علم قول آخر أنه على علم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head17">AUTO الباب الثاني عشر في ذكر المرتبة الثالثة من مراتب القضاء</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head18">AUTO الباب الثالث عشر في ذكر المرتبة الرابعة من مراتب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head19">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head20">AUTO ### | AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head21">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head22">AUTO ### | AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head23">AUTO ### | AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head24">AUTO ### | AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head25">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head26">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head27">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head28">AUTO وإن شاء لم يفعله وقد تقدم تقرير هذا المعنى وبالجملة فكل دليل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head29">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head30">AUTO فصل وهو سبحانه في القرآن كثيرا ما يجمع بين الخلق والهداية</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head31">AUTO فصل ومن هذا إخباره سبحانه بأنه طبع على قلوب الكافرين وختم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head32">AUTO فصل المرتبة الرابعة من مراتب الهداية الهدايه إلى الجنة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head33">AUTO عباس سيهديهم إلى ارشد الأمور وبعضهم أيام حياتهم في الدنيا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head34">AUTO فصل فإن قيل فإذا جوزتم أن يكون الطبع والختم والقفل عقوبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head35">AUTO فصل وأما الغطاء فقال تعالى وعرضنا جهنم يومئذ للكافرين عرضا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head36">AUTO فصل وأما الغلاف فقال تعالى وقالوا قلوبنا غلف بل لعنهم الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head37">AUTO فصل وأما الحجاب ففي قوله تعالى حكاية عنهم ومن بيننا وبينك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head38">AUTO فصل وأما الران فقد قال تعالى كلا بل ران على قلوبهم ما كانوا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head39">AUTO فصل وأما الغل فقال تعالى لقد حق القول على أكثرهم فهم لا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head40">AUTO فصل وأما القفل فقال تعالى أفلا يتدبرون القرآن أم على قلوب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head41">AUTO فصل وأما الصمم والوقر ففي قوله صم بكم عمي وقوله أولئك الذين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head42">AUTO فصل وأما البكم فقال تعالى صم بكم عمي والبكم جمع أبكم وهو</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head43">AUTO فصل وأما الغشاوة فهو غطاء العين كما قال تعالى وجعل على بصره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head44">AUTO فصل وأما الصد فقال تعالى وكذلك زين لفرعون سوء عمله وصد عن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head45">AUTO فصل وأما الصرف فقال تعالى وإذا ما أنزلت سورة نظر بعضهم إلى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head46">AUTO فصل وأما الإغفال فقال تعالى ولا تطع من أغفلنا قبله عن ذكرنا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head47">AUTO فصل وأما المرض فقال تعالى في قلوبهم مرض فزادهم الله مرضا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head48">AUTO فصل وأما تقليب الأفئدة فقال تعالى ونقلب أفئدتهم وأبصارهم كما</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head49">AUTO فصل وأما إزاغة القلوب فقال تعالى فلما زاغوا أزاغ الله قلوبهم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head50">AUTO فصل وأما الخذلان فقال تعالى إن ينصركم الله فلا غالب لكم وإن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head51">AUTO فصل وأما الأركاس فقال تعالى فمالكم في المنافقين فئتين والله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head52">AUTO فصل وأما التثبيط فقال تعالى ولو أرادوا الخروج لأعدوا له عدة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head53">AUTO فصل وأما التزيين فقال تعالى وكذلك زينا لكل أمة عملهم وقال</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head54">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head55">AUTO فصل وأما أماتة قلوبهم ففي قوله إنك لا تسمع الموتى وقوله أومن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head56">AUTO فصل وأما جعله القلب قاسيا فقال تعالى فبما نقضهم ميثاقهم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head57">CHECK [فصل وأما تضييق الصدر وجعله حرجا لا يقبل الإيمان فقال</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head58">AUTO علمه ولا سعيه بل هي محض منته وإحسانه وأكبر من عمله فإذا كان</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head59">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head60">AUTO المتضمن للصنع العجيب الخارج عن العادة كيف تجده كالدليل على</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head61">AUTO رحمته وإحسانه وجوده يقتضي أن لا يؤاخذ من اشتد غضبه بدعائه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head62">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head63">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head64">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head65">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head66">AUTO أدخله في باب العدل والثاني أدخله في باب التوحيد ولم يكن ممن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head67">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head68">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head69">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head70">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head71">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head72">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head73">AUTO قال السني لا تفتقر كل إرادة من العبد إلى مشيئة خاصة من الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head74">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head75">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head76">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head77">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head78">AUTO الثالث أحكام في مقابلة الآيات المنسوخة كما يقوله السلف كثيرا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head79">AUTO ### | AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head80">AUTO ### | AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head81">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head82">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head83">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head84">AUTO ### | AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head85">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head86">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head87">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head88">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head89">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head90">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head91">AUTO الوجه الأربعون قوله أنه سبحانه رد الأمر إلى محض مشيئة بقوله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head92">AUTO وكمال من وجه فالشر ليس إلى الرب تعالى بوجه من الوجوه لا في</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head93">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head94">AUTO الباب السادس والعشرون</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head95">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head96">AUTO الحديث طلب أصول الخير كله ودفع الشر وبالله التوفيق الباب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head97">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head98">AUTO ### | AUTO ### | AUTO ### | AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head99">AUTO وأنبياؤه ورسله وأتباعهم حظهم من هذه الأمور الديني منها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head100">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head101">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head102">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head103">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head104">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head105">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head106">AUTO فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head107">AUTO المانعة من اقتفائها أثرها وهكذا شأن الشرائع التي جاءت بها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head108">AUTO فصل فقد تبين دلالة الكتاب والسنة والآثار واتفاق السلف على أن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head109">AUTO فصل</a>
</li>
</ul>
</body></html></div>
<div class="book body-inner" lang="ara">
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" style="direction: ltr;">
<div class="mr-auto d-flex justify-content-left">
<a class="navbar-brand ms-2" href="http://www.kitab-project.org" target="_blank">
<img class="d-inline-block align-top" src="https://cdn.jsdelivr.net/gh/sohailmerchant/kitab-cdn@main/img/kitab-logo.png" width="60px"/>
</a>
</div>
<div class="navbar-nav mx-auto btn-toolbar" style="direction: rtl;">
<div class="d-flex justify-content-center">
<form class="row" id="nav-form" style="margin-bottom: 0px;">
<span class="btn col justify-content-center">ج:</span>
<select class="col form-select pull-left" id="vol-select"></select>
<span class="btn col justify-content-center">ص:</span>
<select class="col form-select pull-left" id="page-select"></select>
<button class="btn col pull-right mx-3" id="nav-submdit-btn" style="width: 100px;" type="submit" value="Go">Go</button>
</form>
</div>
</div>
<div class="btn-toolbar navbar-nav ml-auto d-flex justify-content-right">
<div class="btn-group">
<a class="nav-link pull-right" title="Go to top">
<i class="btn bi bi-arrow-up-circle" id="back-to-top"></i>
</a>
<a class="nav-link pull-right" title="Increase fonts">
<i class="btn bi bi-fonts font-default pull-left"></i>
</a>
<a class="nav-link pull-right" title="Turn light off">
<i class="btn bi bi-lightbulb-off"></i>
</a>
<div class="nav-link pull-right dropdown">
<a aria-expanded="false" aria-haspopup="true" class="" data-bs-toggle="dropdown" id="dropdownMenuButton" role="button" title="Book Metadata">
<i class="btn bi bi-info"></i>
</a>
<div aria-labelledby="dropdownMenuButton" class="dropdown-menu">
<div class="col-12" id="metadata-content"><label>char_length: 687725</label><label>author_lat_full_name: </label><label>author_lat_shuhra: </label><label>author_from_uri: Ibn Qayyim Jawziyya</label><label>tags:  :: ShamAY@كتب ابن القيم</label><label>url: https://raw.githubusercontent.com/OpenITI/0775AH/master/data/0751IbnQayyimJawziyya/0751IbnQayyimJawziyya.ShifaCalil/0751IbnQayyimJawziyya.ShifaCalil.ShamAY0034426-ara1</label><label>tok_length: 162099</label><label>status: sec</label><label>id: ShamAY0034426</label><label>ed_info: محمد بدر الدين أبو فراس النعساني الحلبي :: دار الفكر - بيروت ، 1398 - 1978</label><label>title_lat: Shifa Calil</label><label>title_ar: شفاء العليل في مسائل القضاء والقدر والحكمة والتعليل :: شفاء العليل - دار الفكر</label><label>book: 0751IbnQayyimJawziyya.ShifaCalil</label><label>author_lat: Ibn Qayyim Jawziyya</label><label>author_ar: أبو عبد الله محمد بن أبي بكر بن أيوب بن سعد، شمس الدين، ابن قيم الجوزية :: الواحدي :: ابن القيم :: محمد بن أبي بكر أيوب الزرعي أبو عبد الله</label><label>date: 0751</label><label>versionUri: 0751IbnQayyimJawziyya.ShifaCalil.ShamAY0034426-ara1</label>
</div>
</div>
</div>
<a class="nav-link pull-right" href="#menu-toggle" id="menu-toggle" title="Book Chapters">
<i class="btn bi bi-list"></i></a>
</div>
</div>
</nav>
<div class="book-body fixed pt-5">
<div class="row">
<div class="col-12">
<div class="row top-heading-panel content-outer-spacing">
</div>
</div>
<div class="col-12" id="meta">
</div>
</div>
<div class="row justify-content-md-center" id="book-main">
<div class="col-lg-8 col-sm-12" id="content">
</div>
</div>
<div class="row mt-5" id="footer">
<div class="col-md-12">
            The KITAB project is based at the Institute for the Study of Muslim Civilizations (ISMC) at Aga Khan
            University, London, and has received funding from the European Research Council (ERC) under the European
            Union's
            Horizon 2020 research and innovation programme (Grant agreement No. 772989)

          </div>
<div class="col-md-12">
<img alt="Logos" height="50" id="logos" src="../img/AKU-EU-ERC-three-logos.jpg"/>
</div>
</div>
</div>
</div>
</div>
<script>

    var pageSel = document.getElementById("page-select");
    var volSel = document.getElementById("vol-select");
    var thisVolume = "01";
    var volPages = {"01": ["001", "002", "003", "004", "005", "006", "007", "008", "009", "010", "011", "012", "013", "014", "015", "016", "017", "018", "019", "020", "021", "022", "023", "024", "026", "027", "028", "029", "030", "031", "032", "033", "034", "035", "036", "037", "038", "039", "040", "041", "042", "043", "044", "045", "046", "047", "048", "049", "050", "051", "052", "053", "054", "055", "056", "057", "058", "059", "060", "061", "062", "063", "064", "065", "066", "067", "068", "069", "070", "071", "072", "073", "074", "075", "076", "077", "078", "079", "080", "081", "082", "083", "084", "085", "086", "087", "088", "089", "090", "091", "092", "093", "094", "095", "096", "097", "098", "099", "100", "101", "102", "103", "104", "105", "106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "118", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "130", "131", "132", "133", "134", "135", "136", "137", "138", "139", "140", "141", "142", "143", "144", "145", "146", "147", "148", "149", "150", "151", "152", "153", "154", "155", "156", "157", "158", "159", "160", "161", "162", "163", "164", "165", "166", "167", "168", "169", "170", "171", "172", "173", "174", "175", "176", "177", "178", "179", "180", "181", "182", "183", "184", "185", "186", "187", "188", "189", "190", "191", "192", "193", "194", "195", "196", "197", "198", "199", "200", "201", "202", "203", "204", "205", "206", "207", "208", "209", "210", "211", "212", "213", "214", "215", "216", "217", "218", "219", "220", "221", "222", "223", "224", "225", "226", "227", "228", "229", "230", "231", "232", "233", "234", "235", "236", "237", "238", "239", "240", "241", "242", "243", "244", "245", "246", "247", "248", "249", "250", "251", "252", "253", "254", "255", "256", "257", "258", "259", "260", "261", "262", "263", "264", "265", "266", "267", "268", "269", "270", "271", "272", "273", "274", "275", "276", "277", "278", "279", "280", "281", "282", "283", "284", "285", "286", "287", "288", "289", "290", "291", "292", "293", "294", "295", "296", "297", "298", "299", "300", "301", "302", "303", "304", "305", "306", "307"]}; /*loaded by html_builder*/

    function goToAnchor(vol, anchorId) {
      if (vol != window.thisVolume) {
        loadVolume(vol, false).then(res => {
          console.log("Volume loaded");
          console.log("Go to anchor " + anchorId);
          /*move the volume page to the element with id=anchorId*/
          /*var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
          console.log(targetAnchor);*/
          /*window.location.hash = "";
          window.location.hash = anchorId;
          window.location.hash = anchorId;
          console.log("#"+anchorId);*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = $("#"+anchorId);
          //$("#content").animate(
          $("html, body").animate(
            {scrollTop: targetAnchor.offset().top},
            1000
          );*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = document.getElementById(anchorId);
          var rect = targetAnchor.getBoundingClientRect();
          console.log(targetAnchor);
          console.log(rect);
          var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
          window.scroll({
            top: rect.top + rect.height / 2 - viewHeight /2,
            behavior: 'smooth'
          });*/
          /*var targetAnchor = document.getElementById(anchorId);
          var contentDiv = document.getElementsByClassName("book-body")[0];
          var topPos = contentDiv.offsetTop;
          var windowSize = $(window).height();
          console.log("topPos: " + topPos);
          console.log("targetPos: " + targetAnchor.offsetTop);
          console.log("windowSize:" + windowSize)
          console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
          contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
          var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({"block": "start"});
        });
      } else {
        /*move the volume page to the element with id=anchorId*/
        /*var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
        console.log(targetAnchor);*/
        /*window.location.hash = "";
        window.location.hash = anchorId;
        window.location.hash = anchorId;
        console.log("#"+anchorId);*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = $("#"+anchorId);
        //$("#content").animate(
        $("html, body").animate(
          {scrollTop: targetAnchor.offset().top},
          1000
        );*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = document.getElementById(anchorId);
        var rect = targetAnchor.getBoundingClientRect();
        console.log(targetAnchor);
        console.log(rect);
        var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        window.scroll({
          top: rect.top + rect.height / 2 - viewHeight /2,
          behavior: 'smooth'
        });*/
        /*var targetAnchor = document.getElementById(anchorId);
        var contentDiv = document.getElementsByClassName("book-body")[0];
        var topPos = contentDiv.offsetTop;
        var windowSize = $(window).height();
        console.log("topPos: " + topPos);
        console.log("targetPos: " + targetAnchor.offsetTop);
        console.log("windowSize:" + windowSize)
        console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
        contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
        var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({"block": "start"});
      }
    }

    CollapsibleLists.apply();
    console.log("Applied CollapsibleLists");

    $(document).ready(function () {
      console.log("Load initial volume " + thisVolume);
      loadVolume(thisVolume).then(res => {
        console.log("Initial volume loaded");
        $('#loading').hide();
        $('#loading').fadeOut("slow");
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 50) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });
      // scroll body to 0px on click
      $('#back-to-top').click(function () {
        $('body,html').animate({
          scrollTop: 0
        }, 400);
        return false;
      });
      $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
      });

      $(".font-default").click(function () {

        $('#wrapper').toggleClass("font-increase", "font-default");
      });

      $(".bi-lightbulb-off").click(function () {
        $('.bi-lightbulb-off').toggleClass("bi-lightbulb", "bi-lightbulb-off");
        $('.page-wrapper').toggleClass("night-mode", "");
        $('.navbar-light').toggleClass("night-mode", "");
        console.log(this);

      });
      $('.toc-item').click(function (event) {
        /*console.log('toc item clicked');*/
        event.preventDefault();
        var clickedElement = event.target;
        /*console.log(clickedElement);*/
        var href = clickedElement.getAttribute("href");
        /*console.log('href: '+href);*/
        var vol = href.substring(0, 2);
        var head = href.split('head').pop();
        var anchorId = "head" + head;
        goToAnchor(vol, anchorId);
        return false;
      });
    });

    function loadPageNumbers(vol, page) {
      /*var pageSel = document.getElementById("page-select");*/
      pageSel.innerHTML = '';
      volPages[vol].forEach(function (p, index) {
        pageSel.options[pageSel.options.length] = new Option(p, p);
      });
      if (page) {
        pageSel.value = page;
      }
    }

    function loadVolumeNumbers(vol) {
      /*var volSel = document.getElementById("vol-select");*/
      volSel.innerHTML = '';
      /*console.log(Object.keys(volPages));*/
      /*console.log(Object.keys(volPages).sort());*/

      Object.keys(volPages).sort().forEach(function (v, index) {
        /*console.log(v);*/
        volSel.options[volSel.options.length] = new Option(v, v);
      });
      volSel.value = vol;
    }

    async function loadVolume(vol) {
      /*Load volume json */
      var page = pageSel.value;
      $('#loading').show();
      console.log("loading volume " + vol);
      await $.getJSON(vol + ".json", function (json) {
        console.log(json)
        $('#content').empty().append(json["content"]);
        /*console.log("json loaded");*/
        window.thisVolume = vol;
        $('#loading').hide();
        $('#loading').fadeOut("slow");
        /*Load volume and page numbers in page-nav form:*/
        loadVolumeNumbers(vol);
        loadPageNumbers(vol, page);
        return true;
      });
    }


    function padWithZeros(number, width) {
      number = number + "";
      if (number.length >= width) {
        return number;
      } else {
        return new Array(width - number.length + 1).join("0") + number;
      }
    }
    document.getElementById("nav-form").addEventListener("submit", function (event) {
      event.preventDefault();
      /*console.log("Clicked Go");*/
      var vol = volSel.value;
      console.log("vol: " + vol);
      /*var targetPage = parseInt(pageSel.value, 10);
      if (page >= 1) {
        page = page-1; //page number is at bottom of page
      }
      var anchor = "v"+vol+"p"+padWithZeros(targetPage, 3);*/
      var targetPage = pageSel.value;
      var pages = volPages[vol];
      var index = pages.indexOf(targetPage);
      if (index > 0) {
        targetPage = pages[index-1];
      }

      console.log("targetPage: " + targetPage);
      var anchor = "v" + vol + "p" + targetPage;
      goToAnchor(vol, anchor);
      return false;
    });

    /*Adapt the page numbers list when the volume number changes:*/
    volSel.addEventListener("change", function (event) {
      var vol = this.value;
      var page = pageSel.value;
      loadPageNumbers(vol, page);
    });


  </script>
</body>
</html>
