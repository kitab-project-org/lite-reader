<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta http-equiv="Content-Security-Policy" https:=""/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri&amp;display=swap" rel="stylesheet"/>
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="../css/stylev2.css" rel="stylesheet" type="text/css"/>
<script crossorigin="anonymous" src="../js/CollapsibleLists.js" type="application/javascript"></script>
<!-- <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/alpheios-components@latest/dist/style/style-components.min.css" /> -->
<script type="text/javascript">
</script>
</head>
<body>
<div id="loading">
<img alt="Loading..." id="loading-image" src="../img/spinner1.gif"/>
</div>
<div class="page-wrapper toggled" id="wrapper">
<div id="sidebar-wrapper">
<html><body><div class="card-header title-heading">فصول الكتاب</div><ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head0">معاملة الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head1">دلائل معرفة الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head2">حقيقة التوسل بحب الصالحين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head3">سياسة النفس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head4">بين اللسان والقلب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head5">فضل عمل القلب على عمل اللسان</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head6">سياسة القلب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head7">أخطار الطمع على القلب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head8">قهر النفس على طلب الآخرة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head9">الخوف والحزن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head10">إبليس يهوى القلوب الخربة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head11">مراقبة الله تعالى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head12">المراقبة والمناجاة من اليقين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head13">من آداب المراقبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head14">العدل والفضل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head15">صفات اهل العدل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head16">أبعد الناس من العدل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head17">التطهير والعمل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head18">الشيطان يضل الناس بالخير وبالشر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head19">الطلب على قدر المعرفة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head20">الخصال التي يطلب منها الخير</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head21">الصدق </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head22">الصواب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head23">الصدق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head24">الشكر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head25">الرجاء</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head26">الخوف</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head27">البلوي والاختبار</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head28">اكثر الفتنة في الناس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head29">الابتلاء في العمل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head30">كيف يهلك العبد بأعمال البر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head31">شمول الفتنة وخطرها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head32">أحذر خداع الشيطان وهوى نفسك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head33">كيف يعرف الانسان سلامته من الافات</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head34">علم السلامة بالمراجعة والتفتيش</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head35">المراجعة اساس السلوك الصحيح</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head36">التهاون في اليسير يوقع في الكبير</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head37">القريب من التوبة والبعيد منها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head38">الخطأ في طريق التوبة ونتائجه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head39">المعرفة بلا عمل وسيلة للعمل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head40">خلاصة المعارف</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head41">المدح والذم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head42">الفرق بين الرياء وحب المدح وكراهة الذم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head43">الخوف من تحول النية</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head44">وجوب الدقة في مراقبة القلب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head45">مذهب الصالحين وأهل الرياء في المدح والذم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head46">زيادة بيان لعلامات الفريقين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head47">اليقين والعز</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head48">صدق اليقين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head49">العز في النفس أصل مرض القلوب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head50">العز عام في الخلق وخاص في القراء</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head51">وسائل علاج العز</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head52">فقه التجارب والعناية بالنفس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head53">الغفلة واليقظة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head54">خصائص الغفلة واليقظة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head55">كيف تكون القوة على اليقظة وترك الغفلة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head56">النية بين الصدق والغفلة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head57">علوم النجاة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head58">جماع ما يجب من العلم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head59">حقيقة النصح</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head60">آداب لا بد منها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head61">النفس واختبارها في المعرفة والسلوك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head62">قمة الخداع النفسي وحقيقة التوسل بالصالحين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head63">المخادعون المتاجرون بالدين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head64">حب الدنيا رأس كل بلاء</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head65">جماع صلاح النفوس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head66">الارادة والصدق والهوى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head67">سبق الهوى على الارادة ms49 الصادقة في العمل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head68">عروض الهوى بعد تقديم الإرادة الصادقة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head69">الرياء والاخلاص وأحكامهما</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head70">العمل الخالي من ذكر الإرادة الصادقة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head71">وجوب العناية بجواهر الاعمال بأسمائها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head72">معرفة الصدق في نقل الارادة من الرياء إلى الصحة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head73">كثرة الخطأ وخفاء الخداع في هذا الباب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head74">دلائل وعلامات</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head75">نعيم الخوف والشوق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head76">المعرفة ونعيم الخوف</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head77">كيف غفل الناس عن هذه الدرجة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head78">المحب مسارع الى القربات</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head79">مراتب العمل لله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head80">السلوك السلفي</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head81">ذكر الآخرة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head82">معرفة الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head83">ارادة الله بالعمل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head84">شكر النعم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head85">معرفة ما يحب الله وما يكره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head86">آفة حب الجاه عند المخلوقين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head87">السمع عن الله والعقل عن الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head88">كمال المراقبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head89">الاعتبار</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head90">الاقتصاد والحزم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head91">إحذر صغائر الذنوب وارغب في صغائر الخير</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head92">كمال ms65 العزم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head93">من فرائد الحكمة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head94">من عيون المعرفة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head95">كيف يكون شكر النعم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head96">الاعتبار بما قبل الولادة وما بعد الموت</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head97">استحي من الله وحده</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head98">حقيقة التواضع</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head99">اصلح ما بينك وبين الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head100">حقائق التوكل</a>
</li>
</ul>
</body></html></div>
<div class="book body-inner" lang="ara">
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" style="direction: ltr;">
<div class="mr-auto d-flex justify-content-left">
<a class="navbar-brand ms-2" href="http://www.kitab-project.org" target="_blank">
<img class="d-inline-block align-top" src="https://cdn.jsdelivr.net/gh/sohailmerchant/kitab-cdn@main/img/kitab-logo.png" width="60px"/>
</a>
</div>
<div class="navbar-nav mx-auto btn-toolbar" style="direction: rtl;">
<div class="d-flex justify-content-center">
<form class="row" id="nav-form" style="margin-bottom: 0px;">
<span class="btn col justify-content-center">ج:</span>
<select class="col form-select pull-left" id="vol-select"></select>
<span class="btn col justify-content-center">ص:</span>
<select class="col form-select pull-left" id="page-select"></select>
<button class="btn col pull-right mx-3" id="nav-submdit-btn" style="width: 100px;" type="submit" value="Go">Go</button>
</form>
</div>
</div>
<div class="btn-toolbar navbar-nav ml-auto d-flex justify-content-right">
<div class="btn-group">
<a class="nav-link pull-right" title="Go to top">
<i class="btn bi bi-arrow-up-circle" id="back-to-top"></i>
</a>
<a class="nav-link pull-right" title="Increase fonts">
<i class="btn bi bi-fonts font-default pull-left"></i>
</a>
<a class="nav-link pull-right" title="Turn light off">
<i class="btn bi bi-lightbulb-off"></i>
</a>
<div class="nav-link pull-right dropdown">
<a aria-expanded="false" aria-haspopup="true" class="" data-bs-toggle="dropdown" id="dropdownMenuButton" role="button" title="Book Metadata">
<i class="btn bi bi-info"></i>
</a>
<div aria-labelledby="dropdownMenuButton" class="dropdown-menu">
<div class="col-12" id="metadata-content"><label>char_length: 96824</label><label>author_lat_full_name: </label><label>author_lat_shuhra: </label><label>author_from_uri: Harith Muhasibi</label><label>tags: CENT0300 :: _ADAB :: _ADHKAR :: _AKHLAQ :: _MISC :: _RAQAIQ :: _SULUK :: GAL@period-classical :: GAL@literature-islamic :: GAL@0750-1000CE :: GAL@literature-arabic :: GAL@sufism :: GAL@mysticism :: Shamela@الرقاق والآداب والأذكار</label><label>url: https://raw.githubusercontent.com/OpenITI/0250AH/master/data/0243HarithMuhasibi/0243HarithMuhasibi.AdabNufus/0243HarithMuhasibi.AdabNufus.Shamela0006853-ara1</label><label>tok_length: 23500</label><label>status: sec</label><label>id: Shamela0006853</label><label>ed_info: عبد القادر أحمد عطا :: دار الجيل - بيروت - لبنان</label><label>title_lat: Adab Nufus</label><label>title_ar: آداب النفوس</label><label>book: 0243HarithMuhasibi.AdabNufus</label><label>author_lat: Harith Muhasibi</label><label>author_ar: الحارث بن أسد المحاسبي، أبو عبد الله (المتوفى: 243هـ)</label><label>date: 0243</label><label>versionUri: 0243HarithMuhasibi.AdabNufus.Shamela0006853-ara1</label>
</div>
</div>
</div>
<a class="nav-link pull-right" href="#menu-toggle" id="menu-toggle" title="Book Chapters">
<i class="btn bi bi-list"></i></a>
</div>
</div>
</nav>
<div class="book-body fixed pt-5">
<div class="row">
<div class="col-12">
<div class="row top-heading-panel content-outer-spacing">
</div>
</div>
<div class="col-12" id="meta">
</div>
</div>
<div class="row justify-content-md-center" id="book-main">
<div class="col-lg-8 col-sm-12" id="content">
</div>
</div>
<div class="row mt-5" id="footer">
<div class="col-md-12">
            The KITAB project is based at the Institute for the Study of Muslim Civilizations (ISMC) at Aga Khan
            University, London, and has received funding from the European Research Council (ERC) under the European
            Union's
            Horizon 2020 research and innovation programme (Grant agreement No. 772989)

          </div>
<div class="col-md-12">
<img alt="Logos" height="50" id="logos" src="../img/AKU-EU-ERC-three-logos.jpg"/>
</div>
</div>
</div>
</div>
</div>
<script>

    var pageSel = document.getElementById("page-select");
    var volSel = document.getElementById("vol-select");
    var thisVolume = "01";
    var volPages = {"01": ["000", "035", "036", "037", "038", "039", "040", "041", "042", "043", "044", "045", "046", "047", "048", "049", "050", "051", "052", "053", "054", "055", "056", "057", "058", "059", "060", "061", "062", "063", "064", "065", "066", "067", "068", "069", "070", "071", "072", "073", "074", "075", "076", "077", "078", "079", "080", "081", "082", "083", "084", "085", "086", "088", "089", "090", "091", "092", "093", "094", "095", "096", "097", "098", "099", "100", "101", "102", "103", "104", "105", "106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "118", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "130", "131", "132", "133", "134", "135", "136", "137", "138", "139", "140", "141", "142", "143", "144", "145", "146", "147", "148", "149", "150", "151", "152", "153", "154", "155", "156", "157", "158", "159", "160", "161", "162", "163", "164", "165", "166", "167", "168", "169", "170", "171", "172", "173", "174", "175", "176", "177", "178", "179", "180", "181", "182", "183", "184", "185", "186", "187", "188", "189", "190", "191", "192", "193", "194", "195", "196", "197", "198"]}; /*loaded by html_builder*/

    function goToAnchor(vol, anchorId) {
      if (vol != window.thisVolume) {
        loadVolume(vol, false).then(res => {
          console.log("Volume loaded");
          console.log("Go to anchor " + anchorId);
          /*move the volume page to the element with id=anchorId*/
          /*var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
          console.log(targetAnchor);*/
          /*window.location.hash = "";
          window.location.hash = anchorId;
          window.location.hash = anchorId;
          console.log("#"+anchorId);*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = $("#"+anchorId);
          //$("#content").animate(
          $("html, body").animate(
            {scrollTop: targetAnchor.offset().top},
            1000
          );*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = document.getElementById(anchorId);
          var rect = targetAnchor.getBoundingClientRect();
          console.log(targetAnchor);
          console.log(rect);
          var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
          window.scroll({
            top: rect.top + rect.height / 2 - viewHeight /2,
            behavior: 'smooth'
          });*/
          /*var targetAnchor = document.getElementById(anchorId);
          var contentDiv = document.getElementsByClassName("book-body")[0];
          var topPos = contentDiv.offsetTop;
          var windowSize = $(window).height();
          console.log("topPos: " + topPos);
          console.log("targetPos: " + targetAnchor.offsetTop);
          console.log("windowSize:" + windowSize)
          console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
          contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
          var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({"block": "start"});
        });
      } else {
        /*move the volume page to the element with id=anchorId*/
        /*var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
        console.log(targetAnchor);*/
        /*window.location.hash = "";
        window.location.hash = anchorId;
        window.location.hash = anchorId;
        console.log("#"+anchorId);*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = $("#"+anchorId);
        //$("#content").animate(
        $("html, body").animate(
          {scrollTop: targetAnchor.offset().top},
          1000
        );*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = document.getElementById(anchorId);
        var rect = targetAnchor.getBoundingClientRect();
        console.log(targetAnchor);
        console.log(rect);
        var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        window.scroll({
          top: rect.top + rect.height / 2 - viewHeight /2,
          behavior: 'smooth'
        });*/
        /*var targetAnchor = document.getElementById(anchorId);
        var contentDiv = document.getElementsByClassName("book-body")[0];
        var topPos = contentDiv.offsetTop;
        var windowSize = $(window).height();
        console.log("topPos: " + topPos);
        console.log("targetPos: " + targetAnchor.offsetTop);
        console.log("windowSize:" + windowSize)
        console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
        contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
        var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({"block": "start"});
      }
    }

    CollapsibleLists.apply();
    console.log("Applied CollapsibleLists");

    $(document).ready(function () {
      console.log("Load initial volume " + thisVolume);
      loadVolume(thisVolume).then(res => {
        console.log("Initial volume loaded");
        $('#loading').hide();
        $('#loading').fadeOut("slow");
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 50) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });
      // scroll body to 0px on click
      $('#back-to-top').click(function () {
        $('body,html').animate({
          scrollTop: 0
        }, 400);
        return false;
      });
      $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
      });

      $(".font-default").click(function () {

        $('#wrapper').toggleClass("font-increase", "font-default");
      });

      $(".bi-lightbulb-off").click(function () {
        $('.bi-lightbulb-off').toggleClass("bi-lightbulb", "bi-lightbulb-off");
        $('.page-wrapper').toggleClass("night-mode", "");
        $('.navbar-light').toggleClass("night-mode", "");
        console.log(this);

      });
      $('.toc-item').click(function (event) {
        /*console.log('toc item clicked');*/
        event.preventDefault();
        var clickedElement = event.target;
        /*console.log(clickedElement);*/
        var href = clickedElement.getAttribute("href");
        /*console.log('href: '+href);*/
        var vol = href.substring(0, 2);
        var head = href.split('head').pop();
        var anchorId = "head" + head;
        goToAnchor(vol, anchorId);
        return false;
      });
    });

    function loadPageNumbers(vol, page) {
      /*var pageSel = document.getElementById("page-select");*/
      pageSel.innerHTML = '';
      volPages[vol].forEach(function (p, index) {
        pageSel.options[pageSel.options.length] = new Option(p, p);
      });
      if (page) {
        pageSel.value = page;
      }
    }

    function loadVolumeNumbers(vol) {
      /*var volSel = document.getElementById("vol-select");*/
      volSel.innerHTML = '';
      /*console.log(Object.keys(volPages));*/
      /*console.log(Object.keys(volPages).sort());*/

      Object.keys(volPages).sort().forEach(function (v, index) {
        /*console.log(v);*/
        volSel.options[volSel.options.length] = new Option(v, v);
      });
      volSel.value = vol;
    }

    async function loadVolume(vol) {
      /*Load volume json */
      var page = pageSel.value;
      $('#loading').show();
      console.log("loading volume " + vol);
      await $.getJSON(vol + ".json", function (json) {
        console.log(json)
        $('#content').empty().append(json["content"]);
        /*console.log("json loaded");*/
        window.thisVolume = vol;
        $('#loading').hide();
        $('#loading').fadeOut("slow");
        /*Load volume and page numbers in page-nav form:*/
        loadVolumeNumbers(vol);
        loadPageNumbers(vol, page);
        return true;
      });
    }


    function padWithZeros(number, width) {
      number = number + "";
      if (number.length >= width) {
        return number;
      } else {
        return new Array(width - number.length + 1).join("0") + number;
      }
    }
    document.getElementById("nav-form").addEventListener("submit", function (event) {
      event.preventDefault();
      /*console.log("Clicked Go");*/
      var vol = volSel.value;
      console.log("vol: " + vol);
      /*var targetPage = parseInt(pageSel.value, 10);
      if (page >= 1) {
        page = page-1; //page number is at bottom of page
      }
      var anchor = "v"+vol+"p"+padWithZeros(targetPage, 3);*/
      var targetPage = pageSel.value;
      var pages = volPages[vol];
      var index = pages.indexOf(targetPage);
      if (index > 0) {
        targetPage = pages[index-1];
      }

      console.log("targetPage: " + targetPage);
      var anchor = "v" + vol + "p" + targetPage;
      goToAnchor(vol, anchor);
      return false;
    });

    /*Adapt the page numbers list when the volume number changes:*/
    volSel.addEventListener("change", function (event) {
      var vol = this.value;
      var page = pageSel.value;
      loadPageNumbers(vol, page);
    });


  </script>
</body>
</html>
