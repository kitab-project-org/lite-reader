<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta http-equiv="Content-Security-Policy" https:=""/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri&amp;display=swap" rel="stylesheet"/>
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="../css/stylev2.css" rel="stylesheet" type="text/css"/>
<script crossorigin="anonymous" src="../js/CollapsibleLists.js" type="application/javascript"></script>
<!-- <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/alpheios-components@latest/dist/style/style-components.min.css" /> -->
<script type="text/javascript">
</script>
</head>
<body>
<div id="loading">
<img alt="Loading..." id="loading-image" src="../img/spinner1.gif"/>
</div>
<div class="page-wrapper toggled" id="wrapper">
<div id="sidebar-wrapper">
<html><body><div class="card-header title-heading">فصول الكتاب</div><ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head0">قاعدة مختصرة في طريق الققر على منهاج الرسول صلى الله عليه وسلم</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head1"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head2">الفصل الأول</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head3">الفصل الثاني</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head4">الفصل الثالث</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head5">الفصل الرابع</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head6">الفصل الخامس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head7">الفصل السادس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head8">الفصل السابع</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head9">الفصل الثامن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head10">الفصل التاسع</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head11">قاعدة في صفة العبودية</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head12"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head13">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head14">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head15">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head16">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head17">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head18">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head19">قاعدة في الحب في الله حقيقة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head20"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head21">قاعدة في ذكر أسباب المحبة لله تعالى</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head22"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head23">فصل :الأسباب التي تتركب منها محبة الله تعالى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head24">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head25">قاعدة في أسباب محبة الله تعالى معرفته وأسباب معرفته</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head26"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head27">قاعدة في مقاصد السالكين</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head28"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head29">قاعدة في بيان عمل يوم وليلة للأبرار وعمل يوم وليلة للسائرين إلى طريق المقربين جعلنا الله منهم</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head30"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head31">قاعدة في شرح حال العباد والصوفية الأفراد جعلنا الله منهم بمنه وكرمه</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head32"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head33">قاعدة في حبس النفس والعكوف على الهم</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head34"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head35">فصل: المراتب المبدوء بذكرها وكيفية قطع مشاقاتها، والترقي في درجاته</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head36">الطور الأول : طور التركيب القالبي :</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head37">الطور التاني : طور القوى النفسانية :</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head38">الطور الثالث : طور العقل:</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head39">الطور الرابع : طور القلب :</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head40">الطور الخامس : طور الروح:</a>
</li>
</ul>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head41">قاعدة في تصفية الأخلاق استعدادا ليوم الحشر والتلاق</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head42"> </a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head43">قاعدة في الفرق بين كبر النفس وعزة القلب وبين البغي والشجاعة وغيرهما</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head44"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head45">قاعدة في أن العبد يتعين عليه معرفة الطريق إلى الله عز وجل والتعرف له</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head46"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head47">قاعدة في تقوية السالك على الوصول إلى مطلوبه</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head48"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head49">قاعدة في المستعد للتصوف</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head50"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head51">قاعدة في خصوص طائفة الصوفية</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head52"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head53">قاعدة يذكر فيها أمر السالك في الابتداء وفيها تعلق بالأولى</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head54"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head55">قاعدة في اعتبار أهل الخير وغيرهم</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head56"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head57">قاعدة في الإنابة إلى الله تعالى</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head58"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head59">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head60">قاعدة في مظاهر الشهود والمعرفة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head61"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head62">قاعدة في أصناف التأله وخصوصية تأله كل طائفة من الطوائف</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head63"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head64">قاعدة تتمة لهذه القاعدة في التألهات</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head65"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head66">قاعدة في بيان السلوك</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head67"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head68">قاعدة في سلوك الأولياء الذين ترامت هممهم إلى الاستقرار في عساكر الأولياء</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head69"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head70">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head71">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head72">قاعدة من علامات التحقق بالقيومية (هذه القاعدة تتمة لما سبقها)</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head73"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head74">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head75">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head76">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head77">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head78">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head79">قاعدة في بدايات الأولياء ومنح أهل المصافات الأصفياء</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head80"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head81">تتمة لكل مقام عبودية بحسبها، فما عبودية من أبدى له الحق من حقه?</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head82">تتمة القاعدة وبداية لها</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head83">قاعدة في بيان الطريق إلى الله تعالى من البداية إلى النهاية</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head84"> </a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head85">قاعدة في تمهيد ما قبلها وتناسبها</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head86"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head87">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head88">قاعدة في الأمور التي ينبغي أن تكون هم السالك</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head89"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head90">قاعدة في سلوك التحقيق إلى غاية المطالب للسائر إلى ربه الذاهب</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head91"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head92">قاعدة في أنواع التفاريق وصفة الجمع في الأمر المكمل لصاحبه</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head93"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head94">قاعدة يعرف العبد فيها نصيبه من ربه ويعده من حظوظ نفسه</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head95"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head96">قاعدة في الأمور الموصلة والأمور القاطعة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head97"> </a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head98">قاعدة في معرفة النقص الداخل على الكمال من العارفين، ومعرفة الكمال في حق هن قام به من الواصلين، أهل البقاء بعد الفناء، والصحو بعد الشكر من مقامات المقربين</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head99"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head100">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head101">قاعدة في نقي الخواطر</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head102"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head103">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head104">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head105">قاعدة في الجد والاجتهاد</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head106"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head107">قاعدة في التجريد</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head108"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head109">تتمة لهذه القاعدة</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head110">قاعدة في الفرق بين العابد والمشاهد</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head111"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head112">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head113">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head114">قاعدة في الفرق بين مشاهدة القيومية والتحقق بها والفرق بين مشاهدة الجمع والتحقق به</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head115"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head116">قاعدة في الوصال واللقاء وهي: بغية المحبين وروح المشتاقين</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head117"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head118">قاعدة شي ميزان الاستقامة لأهل القرب والكرامة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head119"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head120">قاعدة في استجلاب الوداد في معاملة رب الأرباب</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head121"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head122">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head123">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head124">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head125">قاعدة في ذكر الكرامات المعجلة للمنقطعين إلى الله عز وجل في الدنيا</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head126"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head127">قاعدة في العثل الأعلى لقول الله سبحانه: (وله المثل الأعلى) وقول النبي صلى الله عليه وسلم: تبارك اسمك وتعالى جدك.</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head128"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head129">قاعدة في قوله تعالي:إن الله اشترى ms156 من المؤمنين أنفسهم وأموالهم بأن لهم الجنة)</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head130"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head131">تتمة لهذه القاعدة</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head132">قاعدة الروحانيات وفيها بيان لعا قبله</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head133"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head134">قواعد النبوات: قاعدة نبوية</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head135"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head136">فصل</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head137">قاعدة من دلائل النبوة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head138"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head139">قاعدة في تعرف النبوة أيضا</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head140"></a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head141">قاعدة في الصفات</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head142"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head143">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head144">فصل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head145">فصل</a>
</li>
</ul>
</li>
</ul>
</body></html></div>
<div class="book body-inner" lang="ara">
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" style="direction: ltr;">
<div class="mr-auto d-flex justify-content-left">
<a class="navbar-brand ms-2" href="http://www.kitab-project.org" target="_blank">
<img class="d-inline-block align-top" src="https://cdn.jsdelivr.net/gh/sohailmerchant/kitab-cdn@main/img/kitab-logo.png" width="60px"/>
</a>
</div>
<div class="navbar-nav mx-auto btn-toolbar" style="direction: rtl;">
<div class="d-flex justify-content-center">
<form class="row" id="nav-form" style="margin-bottom: 0px;">
<span class="btn col justify-content-center">ج:</span>
<select class="col form-select pull-left" id="vol-select"></select>
<span class="btn col justify-content-center">ص:</span>
<select class="col form-select pull-left" id="page-select"></select>
<button class="btn col pull-right mx-3" id="nav-submdit-btn" style="width: 100px;" type="submit" value="Go">Go</button>
</form>
</div>
</div>
<div class="btn-toolbar navbar-nav ml-auto d-flex justify-content-right">
<div class="btn-group">
<a class="nav-link pull-right" title="Go to top">
<i class="btn bi bi-arrow-up-circle" id="back-to-top"></i>
</a>
<a class="nav-link pull-right" title="Increase fonts">
<i class="btn bi bi-fonts font-default pull-left"></i>
</a>
<a class="nav-link pull-right" title="Turn light off">
<i class="btn bi bi-lightbulb-off"></i>
</a>
<div class="nav-link pull-right dropdown">
<a aria-expanded="false" aria-haspopup="true" class="" data-bs-toggle="dropdown" id="dropdownMenuButton" role="button" title="Book Metadata">
<i class="btn bi bi-info"></i>
</a>
<div aria-labelledby="dropdownMenuButton" class="dropdown-menu">
<div class="col-12" id="metadata-content"><label>char_length: 233607</label><label>author_lat_full_name: </label><label>author_lat_shuhra: </label><label>author_from_uri: Ibn Ibrahim Cimad Din Wasiti</label><label>tags: COMPLETED :: </label><label>url: https://raw.githubusercontent.com/OpenITI/0725AH/master/data/0711IbnIbrahimCimadDinWasiti/0711IbnIbrahimCimadDinWasiti.QawacidFiSuluk/0711IbnIbrahimCimadDinWasiti.QawacidFiSuluk.LMN20200829-ara1.completed</label><label>tok_length: 52239</label><label>status: pri</label><label>id: LMN20200829</label><label>ed_info: http://www.worldcat.org/oclc/915083424</label><label>title_lat: Qawāʿid al-sulūk ilá Allãh taʿālá aw al-sayr ʿalá l-minhāǧ :: none</label><label>title_ar: قواعد السلوك إلى الله تعالى أو السير على لمنهاج :: نoنe</label><label>book: 0711IbnIbrahimCimadDinWasiti.QawacidFiSuluk</label><label>author_lat: Ibn Ibrahim Cimad Din Wasiti</label><label>author_ar: </label><label>date: 0711</label><label>versionUri: 0711IbnIbrahimCimadDinWasiti.QawacidFiSuluk.LMN20200829-ara1</label>
</div>
</div>
</div>
<a class="nav-link pull-right" href="#menu-toggle" id="menu-toggle" title="Book Chapters">
<i class="btn bi bi-list"></i></a>
</div>
</div>
</nav>
<div class="book-body fixed pt-5">
<div class="row">
<div class="col-12">
<div class="row top-heading-panel content-outer-spacing">
</div>
</div>
<div class="col-12" id="meta">
</div>
</div>
<div class="row justify-content-md-center" id="book-main">
<div class="col-lg-8 col-sm-12" id="content">
</div>
</div>
<div class="row mt-5" id="footer">
<div class="col-md-12">
            The KITAB project is based at the Institute for the Study of Muslim Civilizations (ISMC) at Aga Khan
            University, London, and has received funding from the European Research Council (ERC) under the European
            Union's
            Horizon 2020 research and innovation programme (Grant agreement No. 772989)

          </div>
<div class="col-md-12">
<img alt="Logos" height="50" id="logos" src="../img/AKU-EU-ERC-three-logos.jpg"/>
</div>
</div>
</div>
</div>
</div>
<script>

    var pageSel = document.getElementById("page-select");
    var volSel = document.getElementById("vol-select");
    var thisVolume = "01";
    var volPages = {"01": ["023", "024", "025", "026", "027", "028", "029", "030", "031", "032", "033", "034", "035", "036", "037", "038", "039", "040", "041", "042", "043", "044", "045", "046", "047", "048", "049", "050", "051", "052", "053", "054", "055", "056", "057", "058", "059", "060", "061", "062", "063", "064", "065", "066", "067", "068", "069", "070", "071", "072", "073", "074", "075", "076", "077", "078", "079", "080", "081", "082", "083", "084", "085", "086", "087", "088", "089", "090", "091", "092", "093", "094", "095", "096", "097", "098", "099", "100", "101", "102", "103", "104", "105", "106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "118", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "130", "131", "132", "133", "134", "135", "136", "137", "138", "139", "140", "141", "142", "143", "144", "145", "146", "147", "148", "149", "150", "151", "152", "153", "154", "155", "156", "157", "158", "159", "160", "161", "162", "163", "164", "165", "166", "167", "168", "169", "170", "171", "172", "173", "174", "175", "176", "177", "178", "179", "180", "181", "182", "183", "184", "185", "186", "187", "188", "189", "190", "191", "192", "193", "194", "195", "196", "197", "198", "199", "200", "201", "202", "203", "204", "205", "206", "207", "208", "209", "210", "211", "212", "213", "214", "215", "216", "217", "218", "219", "220", "221", "222", "223", "224", "225", "226", "227", "228", "229", "230", "231", "232", "233", "234", "235", "236", "237", "238", "239", "240", "241", "242", "243", "244", "245", "246", "247", "248", "249", "250", "251", "252", "253", "254", "255", "256", "257", "258", "259", "260", "261", "262", "263", "264", "265", "266", "267", "268", "269", "270", "271", "272", "273", "274", "275", "276", "277", "278", "279", "280", "281", "282", "283", "284", "285", "286", "287", "288", "289", "290", "291", "292", "293", "294", "295", "296", "297", "298", "299", "300", "301", "302", "303", "304", "305", "306", "307", "308", "309", "310", "311", "312", "313", "314", "315", "316", "317", "318", "319", "320", "321", "322", "323", "324"]}; /*loaded by html_builder*/

    function goToAnchor(vol, anchorId) {
      if (vol != window.thisVolume) {
        loadVolume(vol, false).then(res => {
          console.log("Volume loaded");
          console.log("Go to anchor " + anchorId);
          /*move the volume page to the element with id=anchorId*/
          /*var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
          console.log(targetAnchor);*/
          /*window.location.hash = "";
          window.location.hash = anchorId;
          window.location.hash = anchorId;
          console.log("#"+anchorId);*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = $("#"+anchorId);
          //$("#content").animate(
          $("html, body").animate(
            {scrollTop: targetAnchor.offset().top},
            1000
          );*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = document.getElementById(anchorId);
          var rect = targetAnchor.getBoundingClientRect();
          console.log(targetAnchor);
          console.log(rect);
          var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
          window.scroll({
            top: rect.top + rect.height / 2 - viewHeight /2,
            behavior: 'smooth'
          });*/
          /*var targetAnchor = document.getElementById(anchorId);
          var contentDiv = document.getElementsByClassName("book-body")[0];
          var topPos = contentDiv.offsetTop;
          var windowSize = $(window).height();
          console.log("topPos: " + topPos);
          console.log("targetPos: " + targetAnchor.offsetTop);
          console.log("windowSize:" + windowSize)
          console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
          contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
          var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({"block": "start"});
        });
      } else {
        /*move the volume page to the element with id=anchorId*/
        /*var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
        console.log(targetAnchor);*/
        /*window.location.hash = "";
        window.location.hash = anchorId;
        window.location.hash = anchorId;
        console.log("#"+anchorId);*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = $("#"+anchorId);
        //$("#content").animate(
        $("html, body").animate(
          {scrollTop: targetAnchor.offset().top},
          1000
        );*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = document.getElementById(anchorId);
        var rect = targetAnchor.getBoundingClientRect();
        console.log(targetAnchor);
        console.log(rect);
        var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        window.scroll({
          top: rect.top + rect.height / 2 - viewHeight /2,
          behavior: 'smooth'
        });*/
        /*var targetAnchor = document.getElementById(anchorId);
        var contentDiv = document.getElementsByClassName("book-body")[0];
        var topPos = contentDiv.offsetTop;
        var windowSize = $(window).height();
        console.log("topPos: " + topPos);
        console.log("targetPos: " + targetAnchor.offsetTop);
        console.log("windowSize:" + windowSize)
        console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
        contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
        var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({"block": "start"});
      }
    }

    CollapsibleLists.apply();
    console.log("Applied CollapsibleLists");

    $(document).ready(function () {
      console.log("Load initial volume " + thisVolume);
      loadVolume(thisVolume).then(res => {
        console.log("Initial volume loaded");
        $('#loading').hide();
        $('#loading').fadeOut("slow");
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 50) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });
      // scroll body to 0px on click
      $('#back-to-top').click(function () {
        $('body,html').animate({
          scrollTop: 0
        }, 400);
        return false;
      });
      $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
      });

      $(".font-default").click(function () {

        $('#wrapper').toggleClass("font-increase", "font-default");
      });

      $(".bi-lightbulb-off").click(function () {
        $('.bi-lightbulb-off').toggleClass("bi-lightbulb", "bi-lightbulb-off");
        $('.page-wrapper').toggleClass("night-mode", "");
        $('.navbar-light').toggleClass("night-mode", "");
        console.log(this);

      });
      $('.toc-item').click(function (event) {
        /*console.log('toc item clicked');*/
        event.preventDefault();
        var clickedElement = event.target;
        /*console.log(clickedElement);*/
        var href = clickedElement.getAttribute("href");
        /*console.log('href: '+href);*/
        var vol = href.substring(0, 2);
        var head = href.split('head').pop();
        var anchorId = "head" + head;
        goToAnchor(vol, anchorId);
        return false;
      });
    });

    function loadPageNumbers(vol, page) {
      /*var pageSel = document.getElementById("page-select");*/
      pageSel.innerHTML = '';
      volPages[vol].forEach(function (p, index) {
        pageSel.options[pageSel.options.length] = new Option(p, p);
      });
      if (page) {
        pageSel.value = page;
      }
    }

    function loadVolumeNumbers(vol) {
      /*var volSel = document.getElementById("vol-select");*/
      volSel.innerHTML = '';
      /*console.log(Object.keys(volPages));*/
      /*console.log(Object.keys(volPages).sort());*/

      Object.keys(volPages).sort().forEach(function (v, index) {
        /*console.log(v);*/
        volSel.options[volSel.options.length] = new Option(v, v);
      });
      volSel.value = vol;
    }

    async function loadVolume(vol) {
      /*Load volume json */
      var page = pageSel.value;
      $('#loading').show();
      console.log("loading volume " + vol);
      await $.getJSON(vol + ".json", function (json) {
        console.log(json)
        $('#content').empty().append(json["content"]);
        /*console.log("json loaded");*/
        window.thisVolume = vol;
        $('#loading').hide();
        $('#loading').fadeOut("slow");
        /*Load volume and page numbers in page-nav form:*/
        loadVolumeNumbers(vol);
        loadPageNumbers(vol, page);
        return true;
      });
    }


    function padWithZeros(number, width) {
      number = number + "";
      if (number.length >= width) {
        return number;
      } else {
        return new Array(width - number.length + 1).join("0") + number;
      }
    }
    document.getElementById("nav-form").addEventListener("submit", function (event) {
      event.preventDefault();
      /*console.log("Clicked Go");*/
      var vol = volSel.value;
      console.log("vol: " + vol);
      /*var targetPage = parseInt(pageSel.value, 10);
      if (page >= 1) {
        page = page-1; //page number is at bottom of page
      }
      var anchor = "v"+vol+"p"+padWithZeros(targetPage, 3);*/
      var targetPage = pageSel.value;
      var pages = volPages[vol];
      var index = pages.indexOf(targetPage);
      if (index > 0) {
        targetPage = pages[index-1];
      }

      console.log("targetPage: " + targetPage);
      var anchor = "v" + vol + "p" + targetPage;
      goToAnchor(vol, anchor);
      return false;
    });

    /*Adapt the page numbers list when the volume number changes:*/
    volSel.addEventListener("change", function (event) {
      var vol = this.value;
      var page = pageSel.value;
      loadPageNumbers(vol, page);
    });


  </script>
</body>
</html>
