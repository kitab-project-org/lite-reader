<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta http-equiv="Content-Security-Policy" https:=""/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri&amp;display=swap" rel="stylesheet"/>
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="../css/stylev2.css" rel="stylesheet" type="text/css"/>
<script crossorigin="anonymous" src="../js/CollapsibleLists.js" type="application/javascript"></script>
<!-- <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/alpheios-components@latest/dist/style/style-components.min.css" /> -->
<script type="text/javascript">
</script>
</head>
<body>
<div id="loading">
<img alt="Loading..." id="loading-image" src="../img/spinner1.gif"/>
</div>
<div class="page-wrapper toggled" id="wrapper">
<div id="sidebar-wrapper">
<html><body><div class="card-header title-heading">فصول الكتاب</div><ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head0">AUTO تاريخ المدينة...</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head1">AUTO مقدمة التحقيق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head2">AUTO الفصل ms006 الأول في أول سكنى المدينة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head3">AUTO ذكر سكنى اليهود الحجاز بعد العماليق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head4">AUTO ذكر نزول الأوس والخزرج المدينة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head5">AUTO ذكر قتل اليهود واستيلاء الأوس والخزرج على المدينة</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head6">AUTO الفصل الثاني في ذكر فتح المدينة وهجرة النبى صلى الله عليه</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head7">AUTO ذكر ما جاء في فتحها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head8">AUTO ذكر هجرة النبى صلى الله عليه وسلم وأصحابه الى المدينة</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head9">AUTO الفصل الثالث فيما جاء في حرمة المدينة وغبارها وتمرها ودعائه</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head10">AUTO ذكر حرمة المدينة الشريفة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head11">AUTO ما جاء في غبار المدينة الشريفة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head12">AUTO ذكر ما يئول ms023 إليه أمر المدينة الشريفة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head13">AUTO ما جاء في تحديد حدود حرم المدينة الشريفة</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head14">AUTO الفصل الرابع في ذكرى أودية المدينة الشريفة وآبارها المنسوبة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head15">AUTO 59...ذكر وادي العقيق وفضله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head16">AUTO 61...ذكر الآباء المنسوبة الى النبى صلى الله عليه وسلم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head17">AUTO ذكر عين النبي صلى الله عليه وسلم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head18">AUTO ذكر جبل أحد والشهداء</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head19">AUTO الفصل الخامس في ذكر إجلاء بني النضير من المدينة وحفر الخندق</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head20">AUTO ذكر حفر الخندق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head21">AUTO ذكر قتل بنى قريظة بالمدينة الشريفة</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head22">AUTO الفصل السادس في ذكر ابتداء بناء مسجد الرسول صلى الله عليه</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head23">AUTO ذكر مسجد رسول الله صلى الله عليه وسلم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head24">AUTO ذكر ما جاء في قبلة مسجد رسول الله صلى الله عليه وسلم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head25">AUTO ذكر حجر أزواج النبى صلى الله عليه وسلم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head26">AUTO ذكر مصلى رسول الله صلى الله عليه وسلم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head27">AUTO ذكر قصة الجذع</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head28">AUTO ذكر منبر النبى صلى الله عليه وسلم وروضته الشريفين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head29">AUTO ذكر سد الأبواب الشوارع في المسجد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head30">AUTO ذكر تجمير المسجد الشريف وتخليقه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head31">AUTO ذكر موضع تأذين بلال رضى الله عنه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head32">AUTO ذكر بطحاء مسجد رسول الله صلى الله عليه وسلم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head33">AUTO ذكر زيادة عثمان رضى الله تعالى عنه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head34">AUTO ذكر زيادة الوليد بن عبد الملك بن مروان</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head35">AUTO 114...ذكر زيادة المهدى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head36">AUTO ذكر بلاعات المسجد وسائر صحنه والسقايات التى كانت فيه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head37">AUTO ذكر احتراق المسجد الشريف</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head38">AUTO قصة هذه النار</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head39">AUTO ذكر الخوخ والأبواب التى كانت في المسجد رسول الله صلى الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head40">AUTO ذكر ذرع المسجد اليوم، وعدد أساطينه وطيقانه وذكر حدود المسجد القديم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head41">AUTO ذكر أسوار المدينة</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head42">AUTO الفصل السابع في ذكر المساجد التى صلى فيها النبى صلى الله عليه وسلم</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head43">AUTO وأما ذكر المساجد المعروفة بالمدينة الشريفة فمنها مسجد قباء،</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head44">AUTO مسجد الفتح</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head45">AUTO قال الحافظ محب الدين: وروى عن معاذ بن سعد أن النبى صلى الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head46">AUTO مسجد الفضيح</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head47">AUTO مسجد الجمعة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head48">AUTO مسجد بني ظفر من الأوس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head49">CHECK [مسجد بني معاوية بن مالك ابن النجار بن الخزرج]</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head50">AUTO مصلى رسول الله صلى الله عليه وسلم للعيد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head51">AUTO مسجد بني يزريق من الخزرج</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head52">AUTO ومسجد بني ساعدة من الخزرج رهط سعد بن عبادة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head53">AUTO ومسجد ابن خدرة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head54">AUTO ومسجد بني مازن</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head55">AUTO ومسجد بني دينار</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head56">AUTO ذكر المساجد التي صلى فيها عليه الصلاة والسلام بين مكة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head57">AUTO ومسجد الزبير</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head58">AUTO ومسجد الغزالة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head59">AUTO ومسجد الصفراء</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head60">AUTO ذكر المساجد المشهورة التي صلى فيها النبي صلى الله عليه وسلم</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head61">AUTO الفصل الثامن في ذكر وفاة رسول الله صلى الله عليه وسلم وأبي</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head62">AUTO وأما ذكر وفاته صلى الله عليه وسلم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head63">AUTO وفاة أبي بكر الصديق رضي الله تعالى عنه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head64">AUTO ذكر وفاة عمر رضي ms111 الله تعالى عنه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head65">AUTO دفن عمر رضي الله تعالى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head66">CHECK [ما جاء أن النبي صلى الله عليه وسلم وأبا بكر وعمر رضي الله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head67">AUTO فضائل عمر رضي الله تعالى عنه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head68">AUTO ما جاء في وضع القبور المقدسة وصفة الحجرة الشريفة</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head69">AUTO الفصل التاسع في حكم زيارة النبى صلى الله عليه وسلم وفضلها</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head70">AUTO ذكر حكم زيارة النبى صلى الله عليه وسلم وفضلها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head71">AUTO الأحاديث الواردة في فضل زيارة القبر المقدس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head72">AUTO الأحاديث الواردة في فضل زيارة القبر المقدس "2"</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head73">AUTO كيفية السلام عليه صلى الله عليه وسلم حال الزيارة والسلام على</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head74">AUTO الكشاف العام</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head75">AUTO مصادر ومراجع التحقيق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head76">AUTO مصادر ومراجع أخرى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head77">AUTO فهرس الكتاب</a>
</li>
</ul>
</body></html></div>
<div class="book body-inner" lang="ara">
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" style="direction: ltr;">
<div class="mr-auto d-flex justify-content-left">
<a class="navbar-brand ms-2" href="http://www.kitab-project.org" target="_blank">
<img class="d-inline-block align-top" src="https://cdn.jsdelivr.net/gh/sohailmerchant/kitab-cdn@main/img/kitab-logo.png" width="60px"/>
</a>
</div>
<div class="navbar-nav mx-auto btn-toolbar" style="direction: rtl;">
<div class="d-flex justify-content-center">
<form class="row" id="nav-form" style="margin-bottom: 0px;">
<span class="btn col justify-content-center">ج:</span>
<select class="col form-select pull-left" id="vol-select"></select>
<span class="btn col justify-content-center">ص:</span>
<select class="col form-select pull-left" id="page-select"></select>
<button class="btn col pull-right mx-3" id="nav-submdit-btn" style="width: 100px;" type="submit" value="Go">Go</button>
</form>
</div>
</div>
<div class="btn-toolbar navbar-nav ml-auto d-flex justify-content-right">
<div class="btn-group">
<a class="nav-link pull-right" title="Go to top">
<i class="btn bi bi-arrow-up-circle" id="back-to-top"></i>
</a>
<a class="nav-link pull-right" title="Increase fonts">
<i class="btn bi bi-fonts font-default pull-left"></i>
</a>
<a class="nav-link pull-right" title="Turn light off">
<i class="btn bi bi-lightbulb-off"></i>
</a>
<div class="nav-link pull-right dropdown">
<a aria-expanded="false" aria-haspopup="true" class="" data-bs-toggle="dropdown" id="dropdownMenuButton" role="button" title="Book Metadata">
<i class="btn bi bi-info"></i>
</a>
<div aria-labelledby="dropdownMenuButton" class="dropdown-menu">
<div class="col-12" id="metadata-content"><label>char_length: 203165</label><label>author_lat_full_name: </label><label>author_lat_shuhra: </label><label>author_from_uri: Qutb Din Nahrawani</label><label>tags:  :: ShamAY@التاريخ</label><label>url: https://raw.githubusercontent.com/OpenITI/1000AH/master/data/0988QutbDinNahrawani/0988QutbDinNahrawani.TarikhMadina/0988QutbDinNahrawani.TarikhMadina.ShamAY0038409-ara1</label><label>tok_length: 49234</label><label>status: pri</label><label>id: ShamAY0038409</label><label>ed_info: مكتبة الثقافة الدينية</label><label>title_lat: Tarikh Madina</label><label>title_ar: تاريخ المدينة :: تاريخ المدينة ¶ تأليف: قطب الدين محمد بن علاء الدين علي بن أحمد النهرواني المكي الحنفي (ت: 988 ه) ¶ تقديم وتعليق وتحقيق: دكتور محمد زينهم ¶ الناشر: مكتبة الثقافة الدينية ¶ [موافق للمطبوع] :: تاريخ المدينة لقطب الدين الحنفي</label><label>book: 0988QutbDinNahrawani.TarikhMadina</label><label>author_lat: Qutb Din Nahrawani</label><label>author_ar: قطب الدين محمد بن علاء الدين علي بن أحمد النهرواني المكي الحنفي (ت: 988 ه) :: قطب الدين النهرواني</label><label>date: 0988</label><label>versionUri: 0988QutbDinNahrawani.TarikhMadina.ShamAY0038409-ara1</label>
</div>
</div>
</div>
<a class="nav-link pull-right" href="#menu-toggle" id="menu-toggle" title="Book Chapters">
<i class="btn bi bi-list"></i></a>
</div>
</div>
</nav>
<div class="book-body fixed pt-5">
<div class="row">
<div class="col-12">
<div class="row top-heading-panel content-outer-spacing">
</div>
</div>
<div class="col-12" id="meta">
</div>
</div>
<div class="row justify-content-md-center" id="book-main">
<div class="col-lg-8 col-sm-12" id="content">
</div>
</div>
<div class="row mt-5" id="footer">
<div class="col-md-12">
            The KITAB project is based at the Institute for the Study of Muslim Civilizations (ISMC) at Aga Khan
            University, London, and has received funding from the European Research Council (ERC) under the European
            Union's
            Horizon 2020 research and innovation programme (Grant agreement No. 772989)

          </div>
<div class="col-md-12">
<img alt="Logos" height="50" id="logos" src="../img/AKU-EU-ERC-three-logos.jpg"/>
</div>
</div>
</div>
</div>
</div>
<script>

    var pageSel = document.getElementById("page-select");
    var volSel = document.getElementById("vol-select");
    var thisVolume = "01";
    var volPages = {"01": ["001", "002", "003", "004", "005", "006", "007", "008", "009", "010", "011", "012", "013", "014", "015", "016", "017", "018", "019", "020", "021", "022", "023", "024", "025", "026", "027", "028", "029", "030", "031", "032", "033", "034", "035", "036", "037", "038", "039", "040", "041", "042", "043", "044", "045", "046", "047", "048", "049", "050", "051", "052", "053", "054", "055", "056", "057", "058", "059", "060", "061", "062", "063", "064", "065", "066", "067", "068", "069", "070", "071", "072", "073", "074", "075", "076", "077", "078", "079", "080", "081", "082", "083", "084", "085", "086", "087", "088", "089", "090", "091", "092", "093", "094", "095", "096", "097", "098", "099", "100", "101", "102", "103", "104", "105", "106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "118", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "130", "131", "132", "133", "134", "135", "136", "137", "138", "139", "140", "141", "142", "143", "144", "145", "146", "147", "148", "149", "150", "151", "152", "153", "154", "155", "156", "157", "158", "159", "160", "161", "162", "163", "164", "165", "166", "167", "168", "169", "170", "171", "172", "173", "174", "175", "176", "177", "178", "179", "180", "181", "182", "183", "184", "185", "186", "187", "188", "189", "190", "191", "192", "193", "194", "195", "196", "197", "198", "199", "200", "201", "202", "228", "229", "230", "231", "232", "233", "234", "235", "236", "237", "238", "239", "240", "241", "242", "243", "244", "245", "246", "247", "248", "005", "006", "007", "008", "021", "022", "023", "024", "025", "029", "031", "032", "033", "034", "035", "036", "037", "038", "039", "040", "043", "044", "045", "046", "047", "048", "049", "050", "051", "053", "054", "055", "059", "060", "062", "063", "065", "067", "068", "070", "071", "074", "076", "078", "079", "084", "085", "087", "092", "095", "096", "097", "098", "099", "101", "102", "104", "106", "107", "109", "111", "116", "118", "119", "124", "128", "133", "134", "136", "141", "142", "145", "151", "155", "159", "161", "162", "165", "167", "169", "170", "171", "172", "181", "182", "183", "184", "185", "186", "191", "193", "195", "197", "198", "199", "200"]}; /*loaded by html_builder*/

    function goToAnchor(vol, anchorId) {
      if (vol != window.thisVolume) {
        loadVolume(vol, false).then(res => {
          console.log("Volume loaded");
          console.log("Go to anchor " + anchorId);
          /*move the volume page to the element with id=anchorId*/
          /*var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
          console.log(targetAnchor);*/
          /*window.location.hash = "";
          window.location.hash = anchorId;
          window.location.hash = anchorId;
          console.log("#"+anchorId);*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = $("#"+anchorId);
          //$("#content").animate(
          $("html, body").animate(
            {scrollTop: targetAnchor.offset().top},
            1000
          );*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = document.getElementById(anchorId);
          var rect = targetAnchor.getBoundingClientRect();
          console.log(targetAnchor);
          console.log(rect);
          var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
          window.scroll({
            top: rect.top + rect.height / 2 - viewHeight /2,
            behavior: 'smooth'
          });*/
          /*var targetAnchor = document.getElementById(anchorId);
          var contentDiv = document.getElementsByClassName("book-body")[0];
          var topPos = contentDiv.offsetTop;
          var windowSize = $(window).height();
          console.log("topPos: " + topPos);
          console.log("targetPos: " + targetAnchor.offsetTop);
          console.log("windowSize:" + windowSize)
          console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
          contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
          var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({"block": "start"});
        });
      } else {
        /*move the volume page to the element with id=anchorId*/
        /*var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
        console.log(targetAnchor);*/
        /*window.location.hash = "";
        window.location.hash = anchorId;
        window.location.hash = anchorId;
        console.log("#"+anchorId);*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = $("#"+anchorId);
        //$("#content").animate(
        $("html, body").animate(
          {scrollTop: targetAnchor.offset().top},
          1000
        );*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = document.getElementById(anchorId);
        var rect = targetAnchor.getBoundingClientRect();
        console.log(targetAnchor);
        console.log(rect);
        var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        window.scroll({
          top: rect.top + rect.height / 2 - viewHeight /2,
          behavior: 'smooth'
        });*/
        /*var targetAnchor = document.getElementById(anchorId);
        var contentDiv = document.getElementsByClassName("book-body")[0];
        var topPos = contentDiv.offsetTop;
        var windowSize = $(window).height();
        console.log("topPos: " + topPos);
        console.log("targetPos: " + targetAnchor.offsetTop);
        console.log("windowSize:" + windowSize)
        console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
        contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
        var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({"block": "start"});
      }
    }

    CollapsibleLists.apply();
    console.log("Applied CollapsibleLists");

    $(document).ready(function () {
      console.log("Load initial volume " + thisVolume);
      loadVolume(thisVolume).then(res => {
        console.log("Initial volume loaded");
        $('#loading').hide();
        $('#loading').fadeOut("slow");
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 50) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });
      // scroll body to 0px on click
      $('#back-to-top').click(function () {
        $('body,html').animate({
          scrollTop: 0
        }, 400);
        return false;
      });
      $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
      });

      $(".font-default").click(function () {

        $('#wrapper').toggleClass("font-increase", "font-default");
      });

      $(".bi-lightbulb-off").click(function () {
        $('.bi-lightbulb-off').toggleClass("bi-lightbulb", "bi-lightbulb-off");
        $('.page-wrapper').toggleClass("night-mode", "");
        $('.navbar-light').toggleClass("night-mode", "");
        console.log(this);

      });
      $('.toc-item').click(function (event) {
        /*console.log('toc item clicked');*/
        event.preventDefault();
        var clickedElement = event.target;
        /*console.log(clickedElement);*/
        var href = clickedElement.getAttribute("href");
        /*console.log('href: '+href);*/
        var vol = href.substring(0, 2);
        var head = href.split('head').pop();
        var anchorId = "head" + head;
        goToAnchor(vol, anchorId);
        return false;
      });
    });

    function loadPageNumbers(vol, page) {
      /*var pageSel = document.getElementById("page-select");*/
      pageSel.innerHTML = '';
      volPages[vol].forEach(function (p, index) {
        pageSel.options[pageSel.options.length] = new Option(p, p);
      });
      if (page) {
        pageSel.value = page;
      }
    }

    function loadVolumeNumbers(vol) {
      /*var volSel = document.getElementById("vol-select");*/
      volSel.innerHTML = '';
      /*console.log(Object.keys(volPages));*/
      /*console.log(Object.keys(volPages).sort());*/

      Object.keys(volPages).sort().forEach(function (v, index) {
        /*console.log(v);*/
        volSel.options[volSel.options.length] = new Option(v, v);
      });
      volSel.value = vol;
    }

    async function loadVolume(vol) {
      /*Load volume json */
      var page = pageSel.value;
      $('#loading').show();
      console.log("loading volume " + vol);
      await $.getJSON(vol + ".json", function (json) {
        console.log(json)
        $('#content').empty().append(json["content"]);
        /*console.log("json loaded");*/
        window.thisVolume = vol;
        $('#loading').hide();
        $('#loading').fadeOut("slow");
        /*Load volume and page numbers in page-nav form:*/
        loadVolumeNumbers(vol);
        loadPageNumbers(vol, page);
        return true;
      });
    }


    function padWithZeros(number, width) {
      number = number + "";
      if (number.length >= width) {
        return number;
      } else {
        return new Array(width - number.length + 1).join("0") + number;
      }
    }
    document.getElementById("nav-form").addEventListener("submit", function (event) {
      event.preventDefault();
      /*console.log("Clicked Go");*/
      var vol = volSel.value;
      console.log("vol: " + vol);
      /*var targetPage = parseInt(pageSel.value, 10);
      if (page >= 1) {
        page = page-1; //page number is at bottom of page
      }
      var anchor = "v"+vol+"p"+padWithZeros(targetPage, 3);*/
      var targetPage = pageSel.value;
      var pages = volPages[vol];
      var index = pages.indexOf(targetPage);
      if (index > 0) {
        targetPage = pages[index-1];
      }

      console.log("targetPage: " + targetPage);
      var anchor = "v" + vol + "p" + targetPage;
      goToAnchor(vol, anchor);
      return false;
    });

    /*Adapt the page numbers list when the volume number changes:*/
    volSel.addEventListener("change", function (event) {
      var vol = this.value;
      var page = pageSel.value;
      loadPageNumbers(vol, page);
    });


  </script>
</body>
</html>
