<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta http-equiv="Content-Security-Policy" https:=""/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri&amp;display=swap" rel="stylesheet"/>
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="../css/stylev2.css" rel="stylesheet" type="text/css"/>
<script crossorigin="anonymous" src="../js/CollapsibleLists.js" type="application/javascript"></script>
<!-- <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/alpheios-components@latest/dist/style/style-components.min.css" /> -->
<script type="text/javascript">
</script>
</head>
<body>
<div id="loading">
<img alt="Loading..." id="loading-image" src="../img/spinner1.gif"/>
</div>
<div class="page-wrapper toggled" id="wrapper">
<div id="sidebar-wrapper">
<html><body><div class="card-header title-heading">فصول الكتاب</div><ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head0">الجزء الثاني من تشريف الايام والعصور ب السلطان الملك المنصور</a>
<ul class="collapsibleList">
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head1">ذكر هلاك أبغا ورجوع الملك إلى تکدار المسمي أحمد </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head2">ومنها ما هو للخواتين </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head3">ذكر صداق مولانا السلطان الملك الصالح</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head4">ذكر إمساك ملاك الكرج والظفر به بقوة الله تعالى </a>
</li>
</ul>
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head5">ثم استهلت سنة إثنتين وثمانين وستمائة. </a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head6">ذکر توجه مولانا ms015 السلطان هو واولاده وجميع العساكر إلى جهة البحيرة لحفر البحر المعروف بالطيرية وذلك لعمارة البلاد وشمول منفعتها. </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head7">ذكر فتوح قلعة قطينا من يد العدو المحذول</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head8">ذكر فتوح ثغر الكختا وإستنقاذه من أيدي الكفار</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head9">ذكر الاغارة على بلاد سيس  من جهة الملكة الحلبية وما ms019 جرى فيها </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head10">ذکر توجه العسكر المنصور إلى جهة الكرك ومضايقتها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head11">هدنة عكا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head12">ذکر توجه مولانا السلطان - عز نصره - إلى البلاد الشامية المحروسة في هذه السنة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head13">ذكر الاهتمام بكتب کتاب مولانا الملك الأشرف ولد مولانا السلطان </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head14">ذکر فتوح تونس بشعار مولانا السلطان واسمه الشريف</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head15">ذکر حضور الفقهاء القفجاق رسلا من جهة الملاك. تنامنکر قریب الملك بركة يهون بجلوسه وإسلامه </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head16">ذكر إمساك بطرك الحدث من بلاد طرابلس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head17">ذكر ما فعله الله في صاحب قبرص </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head18">ذکر وصول الشيخ عبد الرحمن </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head19">ذکر حضور رسل الهند إلى أبواب مولانا السلطان</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head20">ذكر خروج مولانا السلطان الملك الصالح والمولى الملك الأشرف الصيد وصرع مولانا السلطان لكي، مبارك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head21">ذکر موت الأشکری مخائيل وقيام ولده من بعده </a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head22">ثم استهلت سنة ثلات وثمانين وستمائة. PageV01P054</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head23">ذکر تجهيز الرسل إلى الملوك في البحر في ثاني المحرم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head24">ذكر الشروع في عمارة المارستان السعيد المنصوري والمدرسة والقية الشريفة بالقاهرة بين القصرين </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head25">ذكر ما فعله الله في أعداء الإسلام من الفرج والتتار ببركة مولانا السلطان و بوجه السعيد الميمون الطلعة من  هلاك ملوكهم واشتغالهم بنفوسهم </a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head26">فأما الفرنج </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head27">وأما التتار</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head28">ذکر قصد العساكر الحلبية جهة الثيني وما قدره الله لها من نصر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head29">ذكر خروج مولانا السلطانفي هذه السنة إلى الشام المحروس </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head30">ذکر حديث السيل الذي وصل إلى دمشق المحروسة وسلامة الخزائن المعمورة منه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head31">ذكر وفاة صاحب حماة وإحسان مولانا السلطان إلى ولده </a>
</li>
</ul>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head32">[الجزء الثالث من تشريف الايام والعصور بسيرة السلطان الملك المنصور]</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head33">[سنة اربع وثمانين وستمائة]</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head34">ذكر فتوح حصن المرقب  </a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head35">ومما نظم في هذا الفتوح الحسن الآثار من الأشعار  </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head36">ومما قاله المملوك نشرة في صفة المرقب: </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head37">ذكر شيء من أخبار حصن المرقب</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head38">ذكر افتتاح مرقية وحصنها وهدمه  </a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head39">وصفته </a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head40">ذکر متجددات بعد ذلك </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head41">ومن ذلك تسليم حصن بلاطفس واسترجاعه </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head42">ومن ذلك الصلح مع التكفور صاحب سیس </a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head43">ونسخة الهدنة والمين </a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head44">ومن المتجدد في هذه السنة </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head45">ومن ذلك النصر </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head46">ومما تجدد </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head47">ذكر عود مولانا السلطان نصره الله إلى مستقر ملكه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head48">ذکر مبرة نفعها مشترك للناس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head49">ذکر محضور رسل اليمن إلى أبواب مولانا السلطان</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head50">ذكر رحمی عظمي، للخلائق من جملة النعمى</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head51">معدلة: تقيم الحرمة و تقضي بعلو الهمة</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head52">سنة خمس وثمانين وستمائة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head53">ذکر توجه الأمير حسام الدين نطای كفيل السلطنة الشريفة إلى الكرك وتسليمه وحضور من كان فيه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head54">ذکر نزول مولانا السلطان إلى القاهرة</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head55">فمما نظمه المملوك في ذلك </a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head56">ذكر الاغارة على الموصل وبلادها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head57">ذكر تركة مولانا السلطان إلى الشام، وتوجهه إلى ms086 الكرك المحروس </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head58">ذکر حضور صاحب قبر إلى عكا واستيلائه عليها و إنفاذ رسله إلى الأبواب السلطانية</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head59">ذکر وفاء النيل المبارك في ثالث وعشرين مسری وفي النيل المبارك </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head60">ذکر حضور رسل الملوك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head61">ذکر تجهيز ركب الحجاز</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head62">ذكر حركة المساكر المنصورة وتوجهها صحبة الأمير حسام الدين طرنطای، وما سهله الله من فتوحات على يده</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head63">واستهلت سنة ست وثمانين وستمائة </a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head64">ذکر منازلة صهیون </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head65">ذکر فتوح حصن برزيه</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head66">وأما صهيون</a>
</li>
</ul>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l2" href="01.html#head67">[سنة تسعة وثمانين وستمائة]</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head68">ذكر فتوح برج اللاذقية</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head69">ذكر شيء يتعلق بملوك النوبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head70">ذكر صلح الريدراكون البرشنوني وأخوه صاحب صقلية مع مولانا السلطان</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head71">ونسخة الهدنة </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head72">نسخة المين التي خلف مولانا السلطان عليها الملك الريدراغون ولأخوته</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head73">ونسخة اليمين التي كلف بها مولانا السلطان الملك الأشرف بحضور والده - نصرهما الله - </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head74">نسخة اليمين التي يحلف عليها الملك الريدراغون</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head75">صلح الجنوية</a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head76">نسخة هدنة مولانا السلطان مع الجنوية وذلك بحضور الأساقفة والرهبان </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head77">نسخة خط الأسقف الذي خلف الرسول</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head78">نسخة خطوط من حضر هذا الحلف</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head79">ونسخة اليمين التي حلف عليها الرسل وكتبوا خطوطهم عليها بالفرنجي بحضور الأسقف</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head80">نسخة الشهادة عليهم</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head81">ذكر ورود رسل الحبشة إلى أبواب مولانا السلطان </a>
<ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l4" href="01.html#head82">تعريب کتاب ورد بالحبشي</a>
</li>
</ul>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head83">ذکر حضور رسول الغرب من جهة تونس </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head84">ذكر الحركة إلى الشام المحروس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l3" href="01.html#head85">وما نظم المملوك جامع السيرة مرثيا، ويشرح الحال ms114 واصفا ومهنئا مولانا السلطان الملك الأشرف نصره الله :</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</body></html></div>
<div class="book body-inner" lang="ara">
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" style="direction: ltr;">
<div class="mr-auto d-flex justify-content-left">
<a class="navbar-brand ms-2" href="http://www.kitab-project.org" target="_blank">
<img class="d-inline-block align-top" src="https://cdn.jsdelivr.net/gh/sohailmerchant/kitab-cdn@main/img/kitab-logo.png" width="60px"/>
</a>
</div>
<div class="navbar-nav mx-auto btn-toolbar" style="direction: rtl;">
<div class="d-flex justify-content-center">
<form class="row" id="nav-form" style="margin-bottom: 0px;">
<span class="btn col justify-content-center">ج:</span>
<select class="col form-select pull-left" id="vol-select"></select>
<span class="btn col justify-content-center">ص:</span>
<select class="col form-select pull-left" id="page-select"></select>
<button class="btn col pull-right mx-3" id="nav-submdit-btn" style="width: 100px;" type="submit" value="Go">Go</button>
</form>
</div>
</div>
<div class="btn-toolbar navbar-nav ml-auto d-flex justify-content-right">
<div class="btn-group">
<a class="nav-link pull-right" title="Go to top">
<i class="btn bi bi-arrow-up-circle" id="back-to-top"></i>
</a>
<a class="nav-link pull-right" title="Increase fonts">
<i class="btn bi bi-fonts font-default pull-left"></i>
</a>
<a class="nav-link pull-right" title="Turn light off">
<i class="btn bi bi-lightbulb-off"></i>
</a>
<div class="nav-link pull-right dropdown">
<a aria-expanded="false" aria-haspopup="true" class="" data-bs-toggle="dropdown" id="dropdownMenuButton" role="button" title="Book Metadata">
<i class="btn bi bi-info"></i>
</a>
<div aria-labelledby="dropdownMenuButton" class="dropdown-menu">
<div class="col-12" id="metadata-content"><label>char_length: 154945</label><label>author_lat_full_name: Muḥyī al-Dīn Abū al-Faḍl ʿAbdallāh b. Rašīd al-Dīn b. ʿAbd al-Ẓāhir b. Našwān b. ʿAbd al-Ẓāhir b. Naǧdaŧ al-Saʿdī, al-Rawḥī, al-Ǧuḏāmī</label><label>author_lat_shuhra: Muḥyī al-Dīn Ibn ʿAbd al-Ẓāhir</label><label>author_from_uri: Ibn Cabd Zahir</label><label>tags: </label><label>url: https://raw.githubusercontent.com/OpenITI/0700AH/master/data/0692IbnCabdZahir/0692IbnCabdZahir.TashrifAyyam/0692IbnCabdZahir.TashrifAyyam.GVDB20200720-ara1</label><label>tok_length: 34693</label><label>status: pri</label><label>id: GVDB20200720</label><label>ed_info: http://www.worldcat.org/oclc/63163399</label><label>title_lat: Tašrīf al-ayyām wa-l-ʿuṣūr bi-sīraŧ al-sulṭān al-Malik al-Manṣūr :: al-Sīraŧ al-sulṭāniyyaŧ al-Malikiyyaŧ al-Manṣūriyyaŧ</label><label>title_ar: تشريف الأيام والعصور بسيرة السلطان الملك المنصور :: السيرة السلطانية الملكية المنصورية</label><label>book: 0692IbnCabdZahir.TashrifAyyam</label><label>author_lat: Ibn Cabd Zahir :: Muḥyī al-Dīn Ibn ʿAbd al-Ẓāhir :: Muḥyī al-Dīn Abū al-Faḍl ʿAbdallāh b. Rašīd al-Dīn b. ʿAbd al-Ẓāhir b. Našwān b. ʿAbd al-Ẓāhir b. Naǧdaŧ al-Saʿdī, al-Rawḥī, al-Ǧuḏāmī</label><label>author_ar: محيي الدين إبن عبد الظاهر :: محيي الدين أبو الفضل عبدلاه بن رشيد الدين بن عبد الظاهر بن نشوان بن عبد الظاهر بن نجدة السعدي، الروحي، الجذامي</label><label>date: 0692</label><label>versionUri: 0692IbnCabdZahir.TashrifAyyam.GVDB20200720-ara1</label>
</div>
</div>
</div>
<a class="nav-link pull-right" href="#menu-toggle" id="menu-toggle" title="Book Chapters">
<i class="btn bi bi-list"></i></a>
</div>
</div>
</nav>
<div class="book-body fixed pt-5">
<div class="row">
<div class="col-12">
<div class="row top-heading-panel content-outer-spacing">
</div>
</div>
<div class="col-12" id="meta">
</div>
</div>
<div class="row justify-content-md-center" id="book-main">
<div class="col-lg-8 col-sm-12" id="content">
</div>
</div>
<div class="row mt-5" id="footer">
<div class="col-md-12">
            The KITAB project is based at the Institute for the Study of Muslim Civilizations (ISMC) at Aga Khan
            University, London, and has received funding from the European Research Council (ERC) under the European
            Union's
            Horizon 2020 research and innovation programme (Grant agreement No. 772989)

          </div>
<div class="col-md-12">
<img alt="Logos" height="50" id="logos" src="../img/AKU-EU-ERC-three-logos.jpg"/>
</div>
</div>
</div>
</div>
</div>
<script>

    var pageSel = document.getElementById("page-select");
    var volSel = document.getElementById("vol-select");
    var thisVolume = "01";
    var volPages = "volPages"; /*loaded by html_builder*/

    function goToAnchor(vol, anchorId) {
      if (vol != window.thisVolume) {
        loadVolume(vol, false).then(res => {
          console.log("Volume loaded");
          console.log("Go to anchor " + anchorId);
          /*move the volume page to the element with id=anchorId*/
          /*var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
          console.log(targetAnchor);*/
          /*window.location.hash = "";
          window.location.hash = anchorId;
          window.location.hash = anchorId;
          console.log("#"+anchorId);*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = $("#"+anchorId);
          //$("#content").animate(
          $("html, body").animate(
            {scrollTop: targetAnchor.offset().top},
            1000
          );*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = document.getElementById(anchorId);
          var rect = targetAnchor.getBoundingClientRect();
          console.log(targetAnchor);
          console.log(rect);
          var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
          window.scroll({
            top: rect.top + rect.height / 2 - viewHeight /2,
            behavior: 'smooth'
          });*/
          /*var targetAnchor = document.getElementById(anchorId);
          var contentDiv = document.getElementsByClassName("book-body")[0];
          var topPos = contentDiv.offsetTop;
          var windowSize = $(window).height();
          console.log("topPos: " + topPos);
          console.log("targetPos: " + targetAnchor.offsetTop);
          console.log("windowSize:" + windowSize)
          console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
          contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
          var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({"block": "start"});
        });
      } else {
        /*move the volume page to the element with id=anchorId*/
        /*var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
        console.log(targetAnchor);*/
        /*window.location.hash = "";
        window.location.hash = anchorId;
        window.location.hash = anchorId;
        console.log("#"+anchorId);*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = $("#"+anchorId);
        //$("#content").animate(
        $("html, body").animate(
          {scrollTop: targetAnchor.offset().top},
          1000
        );*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = document.getElementById(anchorId);
        var rect = targetAnchor.getBoundingClientRect();
        console.log(targetAnchor);
        console.log(rect);
        var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        window.scroll({
          top: rect.top + rect.height / 2 - viewHeight /2,
          behavior: 'smooth'
        });*/
        /*var targetAnchor = document.getElementById(anchorId);
        var contentDiv = document.getElementsByClassName("book-body")[0];
        var topPos = contentDiv.offsetTop;
        var windowSize = $(window).height();
        console.log("topPos: " + topPos);
        console.log("targetPos: " + targetAnchor.offsetTop);
        console.log("windowSize:" + windowSize)
        console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
        contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
        var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({"block": "start"});
      }
    }

    CollapsibleLists.apply();
    console.log("Applied CollapsibleLists");

    $(document).ready(function () {
      console.log("Load initial volume " + thisVolume);
      loadVolume(thisVolume).then(res => {
        console.log("Initial volume loaded");
        $('#loading').hide();
        $('#loading').fadeOut("slow");
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 50) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });
      // scroll body to 0px on click
      $('#back-to-top').click(function () {
        $('body,html').animate({
          scrollTop: 0
        }, 400);
        return false;
      });
      $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
      });

      $(".font-default").click(function () {

        $('#wrapper').toggleClass("font-increase", "font-default");
      });

      $(".bi-lightbulb-off").click(function () {
        $('.bi-lightbulb-off').toggleClass("bi-lightbulb", "bi-lightbulb-off");
        $('.page-wrapper').toggleClass("night-mode", "");
        $('.navbar-light').toggleClass("night-mode", "");
        console.log(this);

      });
      $('.toc-item').click(function (event) {
        /*console.log('toc item clicked');*/
        event.preventDefault();
        var clickedElement = event.target;
        /*console.log(clickedElement);*/
        var href = clickedElement.getAttribute("href");
        /*console.log('href: '+href);*/
        var vol = href.substring(0, 2);
        var head = href.split('head').pop();
        var anchorId = "head" + head;
        goToAnchor(vol, anchorId);
        return false;
      });
    });

    function loadPageNumbers(vol, page) {
      /*var pageSel = document.getElementById("page-select");*/
      pageSel.innerHTML = '';
      volPages[vol].forEach(function (p, index) {
        pageSel.options[pageSel.options.length] = new Option(p, p);
      });
      if (page) {
        pageSel.value = page;
      }
    }

    function loadVolumeNumbers(vol) {
      /*var volSel = document.getElementById("vol-select");*/
      volSel.innerHTML = '';
      /*console.log(Object.keys(volPages));*/
      /*console.log(Object.keys(volPages).sort());*/

      Object.keys(volPages).sort().forEach(function (v, index) {
        /*console.log(v);*/
        volSel.options[volSel.options.length] = new Option(v, v);
      });
      volSel.value = vol;
    }

    async function loadVolume(vol) {
      /*Load volume json */
      var page = pageSel.value;
      $('#loading').show();
      console.log("loading volume " + vol);
      await $.getJSON(vol + ".json", function (json) {
        console.log(json)
        $('#content').empty().append(json["content"]);
        /*console.log("json loaded");*/
        window.thisVolume = vol;
        $('#loading').hide();
        $('#loading').fadeOut("slow");
        /*Load volume and page numbers in page-nav form:*/
        loadVolumeNumbers(vol);
        loadPageNumbers(vol, page);
        return true;
      });
    }


    function padWithZeros(number, width) {
      number = number + "";
      if (number.length >= width) {
        return number;
      } else {
        return new Array(width - number.length + 1).join("0") + number;
      }
    }
    document.getElementById("nav-form").addEventListener("submit", function (event) {
      event.preventDefault();
      /*console.log("Clicked Go");*/
      var vol = volSel.value;
      console.log("vol: " + vol);
      /*var targetPage = parseInt(pageSel.value, 10);
      if (page >= 1) {
        page = page-1; //page number is at bottom of page
      }
      var anchor = "v"+vol+"p"+padWithZeros(targetPage, 3);*/
      var targetPage = pageSel.value;
      var pages = volPages[vol];
      var index = pages.indexOf(targetPage);
      if (index > 0) {
        targetPage = pages[index-1];
      }

      console.log("targetPage: " + targetPage);
      var anchor = "v" + vol + "p" + targetPage;
      goToAnchor(vol, anchor);
      return false;
    });

    /*Adapt the page numbers list when the volume number changes:*/
    volSel.addEventListener("change", function (event) {
      var vol = this.value;
      var page = pageSel.value;
      loadPageNumbers(vol, page);
    });


  </script>
</body>
</html>
