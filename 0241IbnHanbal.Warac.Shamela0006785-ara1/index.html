<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta http-equiv="Content-Security-Policy" https:=""/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri&amp;display=swap" rel="stylesheet"/>
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="../css/stylev2.css" rel="stylesheet" type="text/css"/>
<script crossorigin="anonymous" src="../js/CollapsibleLists.js" type="application/javascript"></script>
<!-- <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/alpheios-components@latest/dist/style/style-components.min.css" /> -->
<script type="text/javascript">
</script>
</head>
<body>
<div id="loading">
<img alt="Loading..." id="loading-image" src="../img/spinner1.gif"/>
</div>
<div class="page-wrapper toggled" id="wrapper">
<div id="sidebar-wrapper">
<html><body><div class="card-header title-heading">فصول الكتاب</div><ul class="collapsibleList">
<li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head0"></a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head1">ما يكره لأهل الثغور وبغداد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head2">باب ما يكره من ترك السوق والعمل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head3">باب ما يستحب من الكسب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head4">ما يستحب من عمل المدين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head5">ترك الكبر ولزوم العمل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head6">الشراء من الموضع الذي يكره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head7">التنزه عن معاملة من يكره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head8">مبايعة من يكره ناحيته وأهل البدع</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head9">ما يكره من الشراء من الموضع الذي يكره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head10">الشراء من نهر سعيد وأشباهه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head11">ما يكره من المساجد التي في الطريق والصلاة فيها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head12">ما يكره من الحدث في طريق المسلمين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head13">ما يكره من الشرب من الآبار التي في الطريق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head14">ما يكره من الشرب من الآبار التي احتفرها من يكره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head15">ما يكره من المشي على العبارة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head16">ما يكره من فضل غسل الميت أن يتوضأ بفضله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head17">ما يصنع بما فضل من بواري المسجد والجص والآجر والخشب وما هذا سبيله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head18">الرخصة فيما كان ms15 لعامة الناس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head19">الصلاة داخل المسجد الجامع وفضل الاتباع</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head20">ما يذكر من تفريق السبي</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head21">التنزه عن أمر المقسم والفضل منه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head22">ما يكره من إسخان الماء بحطب من يكره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head23">ما يفسد الطيب من الخبيث</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head24">ما يحل ويحرم عليه وكيف سلم له الحلال</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head25">ما يكره من أمر الربا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head26">هل للوالدين طاعة في الشبهة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head27">طاعة الوالدة والمدارة (لها) في الشبهة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head28">ما كره من عون القرابة إذا كان ممن كره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head29">الرجل يعامل بالربا إذا أراد أن يتوب كيف يعمل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head30">من كره مبايعة نساء من تكره ناحيته</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head31">الرجل يحجر على والده والرجل يريد الصيد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head32">ما يكره من التجارة في الأرض التي تكره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head33">تعظيم المساجد وما كره من عمل الدنيا فيها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head34">ما كره من عمل الدنيا في المقابر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head35">الرجل يشتري الدقيق فيزيد على كيله</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head36">علم البائع والمشتري في البيع</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head37">آنية الفضة تباع والحرير والديباج</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head38">كسب الحجام</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head39">الرجل يتخذ الغلة في السواد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head40">الرجل يعطي الشيء فيتبين أنه يكره</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head41">مسائل في الورع</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head42">باب ما يكره من الصدقة لبني هاشم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head43">من كره طعاما من شبهة فاستقاءه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head44">الجزء الثاني من الكتاب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head45">في التقلل وترك الشهوات</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head46">في الورع ودقائق المسائل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head47">السراج أو النار أو الحطب لمن ms42 تكره ناحيته يستضاء به أو يخبز به أو يطبخ</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head48">الرجل يأمره والده أن يشتري له الثوب أو الحاجة بدارهم يكرهها وما للرجل من مال ابنه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head49">الرجل يهب لابنه أو لابنته أله أن يرجع فيها أم لا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head50">رجل وهب لابنته جارية وأراد شراءها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head51">باب الهبة والرجل يقول لامرأته هبي لي مهرك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head52">الرجل يتزوج أو يشتري الجارية من مال ولده</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head53">ما يحل للرجل من مال أبيه وللمرأة من مال زوجها</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head54">نظر الفجأة وما يكره من النظر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head55">{ولمن خاف مقام ربه جنتان} الرحمن </a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head56">المرأة المريضة يعالجها الرجل والخادم ينظر إلى شعر مولاته</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head57">الأمر بالتزويج وما فيه من الفضل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head58">ذكر بعض العلماء الورعين</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head59">المفطر المضطر إلى الماء والميتة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head60">القدر توجد مطبوخة في بلاد الروم</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head61">الغزو في شدة البرد والحر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head62">الوالي يحرج من ذبح أو حلب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head63">القاتل إذا تاب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head64">أجور بيوت مكة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head65">ترك بعض الحلال مخافة الحرام</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head66">باب من ورث مالا فيه شبهة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head67">من أي شيء يخرج من الوليمة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head68">كراهية شراء اللعب وما في الصور</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head69">ما جاء في قبلة اليد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head70">العسل يوجد في بلاد الروم أيؤكل</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head71">اللصوص متى يقاتلون</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head72">الذرية يسبون إذا نقضوا العهد</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head73">المريض من المسلمين يجدوه في الغزو</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head74">أمير السرية يحرج على الناس أن يسيروا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head75">الأسير في أيدي العدو يسرق</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head76">تواضع الرجل وذم نفسه إذا مدح</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head77">كيف الأمر بالمعروف والنهي عن المنكر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head78">تحريم المسكر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head79">من أوجب الحد في الريح والعقوبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head80">ما كره من بيع العصير وما أشبهه</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head81">من كره أن يحضر وليمة فيها مسكر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head82">ما كره من الصدقة على من يشرب المسكر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head83">من خلف بالطلاق على ابنه أن يشرب دواء مع مسكر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head84">في الخياطة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head85">لبس النعال السندية</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head86">كراهية صبغ الحمرة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head87">ما كره من لبس الثياب الرقاق والطراز في الثوب</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head88">خضاب النساء وما يكره من ذلك</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head89">ما يكره من التحذيف وحلق القفا</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head90">ما كره من الوصل في الشعر</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head91">حلق الرأس</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head92">ما كره من الجص</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head93">من كره تجصص المساجد أو ms76 تزخرف</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head94">ما كره من التزوايق في السقف</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head95">ما كره من الغيبة</a>
</li><li class="collapsibleListClosed">
<a class="toc-item l1" href="01.html#head96">ذكر النعيم</a>
</li>
</ul>
</body></html></div>
<div class="book body-inner" lang="ara">
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top border-bottom" style="direction: ltr;">
<div class="mr-auto d-flex justify-content-left">
<a class="navbar-brand ms-2" href="http://www.kitab-project.org" target="_blank">
<img class="d-inline-block align-top" src="https://cdn.jsdelivr.net/gh/sohailmerchant/kitab-cdn@main/img/kitab-logo.png" width="60px"/>
</a>
</div>
<div class="navbar-nav mx-auto btn-toolbar" style="direction: rtl;">
<div class="d-flex justify-content-center">
<form class="row" id="nav-form" style="margin-bottom: 0px;">
<span class="btn col justify-content-center">ج:</span>
<select class="col form-select pull-left" id="vol-select"></select>
<span class="btn col justify-content-center">ص:</span>
<select class="col form-select pull-left" id="page-select"></select>
<button class="btn col pull-right mx-3" id="nav-submdit-btn" style="width: 100px;" type="submit" value="Go">Go</button>
</form>
</div>
</div>
<div class="btn-toolbar navbar-nav ml-auto d-flex justify-content-right">
<div class="btn-group">
<a class="nav-link pull-right" title="Go to top">
<i class="btn bi bi-arrow-up-circle" id="back-to-top"></i>
</a>
<a class="nav-link pull-right" title="Increase fonts">
<i class="btn bi bi-fonts font-default pull-left"></i>
</a>
<a class="nav-link pull-right" title="Turn light off">
<i class="btn bi bi-lightbulb-off"></i>
</a>
<div class="nav-link pull-right dropdown">
<a aria-expanded="false" aria-haspopup="true" class="" data-bs-toggle="dropdown" id="dropdownMenuButton" role="button" title="Book Metadata">
<i class="btn bi bi-info"></i>
</a>
<div aria-labelledby="dropdownMenuButton" class="dropdown-menu">
<div class="col-12" id="metadata-content"><label>char_length: 91289</label><label>author_lat_full_name:  Abū ʿabd allāh Aḥmad b. muḥammad b. ḥanbal al-šaybānī</label><label>author_lat_shuhra: aḥmad b. ḥanbal</label><label>author_from_uri: Ibn Hanbal</label><label>tags: MARKDOWN :: CENT0300 :: _AJZA :: _AKHLAQ :: _HADITH :: GAL@period-classical :: GAL@literature-islamic :: GAL@0750-1000CE :: GAL@literature-arabic :: GAL@lesserschools :: GAL@fiqh :: Shamela@الأجزاء الحديثية</label><label>url: https://raw.githubusercontent.com/OpenITI/0250AH/master/data/0241IbnHanbal/0241IbnHanbal.Warac/0241IbnHanbal.Warac.Shamela0006785-ara1.mARkdown</label><label>tok_length: 23998</label><label>status: pri</label><label>id: Shamela0006785</label><label>ed_info: سمير بن أمين الزهيري :: دار الصميعي - الرياض - السعودية :: http://www.worldcat.org/oclc/39620646</label><label>title_lat: Kitāb al-waraʿ :: al-waraʿ</label><label>title_ar: كتاب الورع :: الورع</label><label>book: 0241IbnHanbal.Warac</label><label>author_lat: Ibn Hanbal :: aḥmad b. ḥanbal ::  Abū ʿabd allāh Aḥmad b. muḥammad b. ḥanbal al-šaybānī</label><label>author_ar: أحمد بن حنبل ::  أبو عبد ألاه أحمد بن محمد بن حنبل الشيباني</label><label>date: 0241</label><label>versionUri: 0241IbnHanbal.Warac.Shamela0006785-ara1</label>
</div>
</div>
</div>
<a class="nav-link pull-right" href="#menu-toggle" id="menu-toggle" title="Book Chapters">
<i class="btn bi bi-list"></i></a>
</div>
</div>
</nav>
<div class="book-body fixed pt-5">
<div class="row">
<div class="col-12">
<div class="row top-heading-panel content-outer-spacing">
</div>
</div>
<div class="col-12" id="meta">
</div>
</div>
<div class="row justify-content-md-center" id="book-main">
<div class="col-lg-8 col-sm-12" id="content">
</div>
</div>
<div class="row mt-5" id="footer">
<div class="col-md-12">
            The KITAB project is based at the Institute for the Study of Muslim Civilizations (ISMC) at Aga Khan
            University, London, and has received funding from the European Research Council (ERC) under the European
            Union's
            Horizon 2020 research and innovation programme (Grant agreement No. 772989)

          </div>
<div class="col-md-12">
<img alt="Logos" height="50" id="logos" src="../img/AKU-EU-ERC-three-logos.jpg"/>
</div>
</div>
</div>
</div>
</div>
<script>

    var pageSel = document.getElementById("page-select");
    var volSel = document.getElementById("vol-select");
    var thisVolume = "01";
    var volPages = {"01": ["000", "001", "005", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "052", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "081", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "102", "103", "104", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "000", "126", "000", "000", "000", "000", "000", "132", "133", "134"]}; /*loaded by html_builder*/

    function goToAnchor(vol, anchorId) {
      if (vol != window.thisVolume) {
        loadVolume(vol, false).then(res => {
          console.log("Volume loaded");
          console.log("Go to anchor " + anchorId);
          /*move the volume page to the element with id=anchorId*/
          /*var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
          console.log(targetAnchor);*/
          /*window.location.hash = "";
          window.location.hash = anchorId;
          window.location.hash = anchorId;
          console.log("#"+anchorId);*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = $("#"+anchorId);
          //$("#content").animate(
          $("html, body").animate(
            {scrollTop: targetAnchor.offset().top},
            1000
          );*/
          /*//This approach does not work at all: scrolls only main window.
          var targetAnchor = document.getElementById(anchorId);
          var rect = targetAnchor.getBoundingClientRect();
          console.log(targetAnchor);
          console.log(rect);
          var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
          window.scroll({
            top: rect.top + rect.height / 2 - viewHeight /2,
            behavior: 'smooth'
          });*/
          /*var targetAnchor = document.getElementById(anchorId);
          var contentDiv = document.getElementsByClassName("book-body")[0];
          var topPos = contentDiv.offsetTop;
          var windowSize = $(window).height();
          console.log("topPos: " + topPos);
          console.log("targetPos: " + targetAnchor.offsetTop);
          console.log("windowSize:" + windowSize)
          console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
          contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
          var targetAnchor = document.getElementById(anchorId);
          targetAnchor.scrollIntoView({"block": "start"});
        });
      } else {
        /*move the volume page to the element with id=anchorId*/
        /*var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({block: 'nearest'});  // this does not always work...
        console.log(targetAnchor);*/
        /*window.location.hash = "";
        window.location.hash = anchorId;
        window.location.hash = anchorId;
        console.log("#"+anchorId);*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = $("#"+anchorId);
        //$("#content").animate(
        $("html, body").animate(
          {scrollTop: targetAnchor.offset().top},
          1000
        );*/
        /*//This approach does not work at all: scrolls only main window.
        var targetAnchor = document.getElementById(anchorId);
        var rect = targetAnchor.getBoundingClientRect();
        console.log(targetAnchor);
        console.log(rect);
        var viewHeight=Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        window.scroll({
          top: rect.top + rect.height / 2 - viewHeight /2,
          behavior: 'smooth'
        });*/
        /*var targetAnchor = document.getElementById(anchorId);
        var contentDiv = document.getElementsByClassName("book-body")[0];
        var topPos = contentDiv.offsetTop;
        var windowSize = $(window).height();
        console.log("topPos: " + topPos);
        console.log("targetPos: " + targetAnchor.offsetTop);
        console.log("windowSize:" + windowSize)
        console.log("targetAnchor.offsetTop-windowSize/3 = " + (targetAnchor.offsetTop - topPos - windowSize / 2));
        contentDiv.scrollTop = targetAnchor.offsetTop - topPos - windowSize / 2;*/
        var targetAnchor = document.getElementById(anchorId);
        targetAnchor.scrollIntoView({"block": "start"});
      }
    }

    CollapsibleLists.apply();
    console.log("Applied CollapsibleLists");

    $(document).ready(function () {
      console.log("Load initial volume " + thisVolume);
      loadVolume(thisVolume).then(res => {
        console.log("Initial volume loaded");
        $('#loading').hide();
        $('#loading').fadeOut("slow");
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 50) {
          $('#back-to-top').fadeIn();
        } else {
          $('#back-to-top').fadeOut();
        }
      });
      // scroll body to 0px on click
      $('#back-to-top').click(function () {
        $('body,html').animate({
          scrollTop: 0
        }, 400);
        return false;
      });
      $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
      });

      $(".font-default").click(function () {

        $('#wrapper').toggleClass("font-increase", "font-default");
      });

      $(".bi-lightbulb-off").click(function () {
        $('.bi-lightbulb-off').toggleClass("bi-lightbulb", "bi-lightbulb-off");
        $('.page-wrapper').toggleClass("night-mode", "");
        $('.navbar-light').toggleClass("night-mode", "");
        console.log(this);

      });
      $('.toc-item').click(function (event) {
        /*console.log('toc item clicked');*/
        event.preventDefault();
        var clickedElement = event.target;
        /*console.log(clickedElement);*/
        var href = clickedElement.getAttribute("href");
        /*console.log('href: '+href);*/
        var vol = href.substring(0, 2);
        var head = href.split('head').pop();
        var anchorId = "head" + head;
        goToAnchor(vol, anchorId);
        return false;
      });
    });

    function loadPageNumbers(vol, page) {
      /*var pageSel = document.getElementById("page-select");*/
      pageSel.innerHTML = '';
      volPages[vol].forEach(function (p, index) {
        pageSel.options[pageSel.options.length] = new Option(p, p);
      });
      if (page) {
        pageSel.value = page;
      }
    }

    function loadVolumeNumbers(vol) {
      /*var volSel = document.getElementById("vol-select");*/
      volSel.innerHTML = '';
      /*console.log(Object.keys(volPages));*/
      /*console.log(Object.keys(volPages).sort());*/

      Object.keys(volPages).sort().forEach(function (v, index) {
        /*console.log(v);*/
        volSel.options[volSel.options.length] = new Option(v, v);
      });
      volSel.value = vol;
    }

    async function loadVolume(vol) {
      /*Load volume json */
      var page = pageSel.value;
      $('#loading').show();
      console.log("loading volume " + vol);
      await $.getJSON(vol + ".json", function (json) {
        console.log(json)
        $('#content').empty().append(json["content"]);
        /*console.log("json loaded");*/
        window.thisVolume = vol;
        $('#loading').hide();
        $('#loading').fadeOut("slow");
        /*Load volume and page numbers in page-nav form:*/
        loadVolumeNumbers(vol);
        loadPageNumbers(vol, page);
        return true;
      });
    }


    function padWithZeros(number, width) {
      number = number + "";
      if (number.length >= width) {
        return number;
      } else {
        return new Array(width - number.length + 1).join("0") + number;
      }
    }
    document.getElementById("nav-form").addEventListener("submit", function (event) {
      event.preventDefault();
      /*console.log("Clicked Go");*/
      var vol = volSel.value;
      console.log("vol: " + vol);
      /*var targetPage = parseInt(pageSel.value, 10);
      if (page >= 1) {
        page = page-1; //page number is at bottom of page
      }
      var anchor = "v"+vol+"p"+padWithZeros(targetPage, 3);*/
      var targetPage = pageSel.value;
      var pages = volPages[vol];
      var index = pages.indexOf(targetPage);
      if (index > 0) {
        targetPage = pages[index-1];
      }

      console.log("targetPage: " + targetPage);
      var anchor = "v" + vol + "p" + targetPage;
      goToAnchor(vol, anchor);
      return false;
    });

    /*Adapt the page numbers list when the volume number changes:*/
    volSel.addEventListener("change", function (event) {
      var vol = this.value;
      var page = pageSel.value;
      loadPageNumbers(vol, page);
    });


  </script>
</body>
</html>
